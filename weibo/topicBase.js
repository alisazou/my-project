STK.register("kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b,c){var d=a.core.util.language(b,$LANG);d=d.replace(/\\}/ig,"}");c&&(d=a.templet(d,c));return d}});
STK.register("kit.dom.parseDOM",function(a){return function(a){for(var b in a)a[b]&&a[b].length==1&&(a[b]=a[b][0]);return a}});
STK.register("common.listener",function(a){var b={},c={};c.define=function(c,d){if(b[c]!=null)throw"common.listener.define: 频道已被占用";b[c]=d;var e={};e.register=function(d,e){if(b[c]==null)throw"common.listener.define: 频道未定义";a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null)throw"commonlistener.define: 频道未定义";a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("common.channel.feed",function(a){var b=["publish","forward","voteforward","forward_hide","comment","votecomment","comment_hide","reload"];return a.common.listener.define("common.channel.feed",b)});
STK.register("kit.extra.merge",function(a){return function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}});
STK.register("core.str.trim",function(a){return function(a){if(typeof a!="string")throw"trim need a string as parameter";var b=a.length,c=0,d=/(\u3000|\s|\t|\u00A0)/;while(c<b){if(!d.test(a.charAt(c)))break;c+=1}while(b>c){if(!d.test(a.charAt(b-1)))break;b-=1}return a.slice(c,b)}});
STK.register("core.json.jsonToQuery",function(a){var b=function(b,c){b=b==null?"":b;b=a.core.str.trim(b.toString());return c?encodeURIComponent(b):b};return function(a,c){var d=[];if(typeof a=="object")for(var e in a){if(e==="$nullName"){d=d.concat(a[e]);continue}if(a[e]instanceof Array)for(var f=0,g=a[e].length;f<g;f++)d.push(e+"="+b(a[e][f],c));else typeof a[e]!="function"&&d.push(e+"="+b(a[e],c))}return d.length?d.join("&"):""}});
STK.register("common.log.monitor",function(a){var b="http://www.weibojs.com/log/widget.php",c={refer:document.referrer,title:document.title,ua:window.navigator.userAgent,os:window.navigator.platform+"|"+window.navigator.oscpu},d=!0,e=function(a){var b=new Image;d&&(b.src=a);b=null};return function(d){var f={},g=a.kit.extra.merge(c,d),h=[];for(var i in g){var j=g[i];typeof j=="object"&&(j=a.core.json.jsonToQuery(j));h.push(i+"="+encodeURIComponent(j))}var k=b+"?"+h.join("&");e(k);f.monitor=e;return f}});
STK.register("kit.io.ajax",function(a){return function(b){var c,d,e,f,g,h,i,j=function(b){a.common.log.monitor({url:document.location.protocol+"//"+document.location.hostname+(c.url.charAt(0)=="/"?c.url:"/"+c.url),param:c.args,method:c.method,result:b&&(b.code||0),httpcode:f.status})};h=function(a){g=!1;b.onComplete(a,c.args);setTimeout(k,0)};i=function(a){g=!1;b.onFail&&b.onFail(a,c.args);j(a);setTimeout(k,0)};e=[];f=null;g=!1;c=a.parseParam({url:"",method:"get",responseType:"json",timeout:3e4,onTraning:a.funcEmpty,isEncode:!0},b);c.onComplete=h;c.onFail=i;var k=function(){if(!!e.length){if(g===!0)return;g=!0;c.args=e.shift();f=a.ajax(c)}},l=function(a){while(e.length)e.shift();g=!1;if(f)try{f.abort()}catch(b){}f=null};d={};d.request=function(a){a||(a={});b.noQueue&&l();if(!b.uniqueRequest||!f){e.push(a);a._t=0;k()}};d.abort=l;return d}});
STK.register("kit.io.jsonp",function(a){return function(b){var c,d,e,f,g;c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:3e4,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:!0},b);e=[];f={};g=!1;var h=function(){if(!!e.length){if(g===!0)return;g=!0;f.args=e.shift();f.onComplete=function(a){g=!1;c.onComplete(a,f.args);setTimeout(h,0)};f.onFail=function(a){g=!1;c.onFail(a);setTimeout(h,0)};a.jsonp(a.kit.extra.merge(c,{args:f.args,onComplete:function(a){f.onComplete(a)},onFail:function(a){try{f.onFail(a)}catch(b){}}}))}};d={};d.request=function(a){a||(a={});e.push(a);a._t=1;h()};d.abort=function(a){while(e.length)e.shift();g=!1;f=null};return d}});
STK.register("kit.io.inter",function(a){return function(){var b,c,d;b={};c={};d={};b.register=function(a,b){if(c[a]!==undefined)throw a+" interface has been registered";c[a]=b;d[a]={}};b.hookComplete=function(b,c){var e=a.core.util.getUniqueKey();d[b][e]=c;return e};b.removeHook=function(a,b){d[a]&&d[a][b]&&delete d[a][b]};b.getTrans=function(b,e){var f=a.kit.extra.merge(c[b],e);f.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a.code==="100000")try{e.onSuccess(a,c)}catch(f){}else try{e.onError(a,c)}catch(f){}for(var g in d[b])try{d[b][g](a,c)}catch(f){}};return c[b].requestMode==="jsonp"?a.kit.io.jsonp(f):c[b].requestMode==="ijax"?a.kit.io.ijax(f):a.kit.io.ajax(f)};b.request=function(b,e,f){var g=a.core.json.merge(c[b],e);g.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a.code==="100000")try{e.onSuccess(a,c)}catch(f){}else try{if(a.code==="100002"){window.location.href=a.data;return}e.onError(a,c)}catch(f){}for(var g in d[b])try{d[b][g](a,c)}catch(f){}};g=a.core.obj.cut(g,["noqueue"]);g.args=f;return c[b].requestMode==="jsonp"?a.jsonp(g):c[b].requestMode==="ijax"?a.ijax(g):a.ajax(g)};return b}});
STK.register("common.trans.topic",function(a){var b=location.host=="widget.weibo.com"||location.host=="dev.weibo.com"?"":"/widget",c=a.kit.io.inter(),d=c.register;d("addmblog",{url:b+"/public/aj_addMblog.php",method:"post"});d("addfav",{url:b+"/public/aj_addfav.php",method:"post"});d("delfav",{url:b+"/public/aj_delfav.php",method:"post"});d("repost",{url:b+"/public/aj_repost.php",method:"post"});d("comment",{url:b+"/public/aj_comment.php",method:"post"});d("search",{url:b+"/topics/aj_searchmblog.php"});d("search_topic",{url:b+"/topics/aj_searchtopic.php"});d("check",{url:b+"/public/aj_checkstatus.php"});d("person_info",{url:b+"/public/aj_getuserinfo.php"});d("get_forward",{url:b+"/public/aj_getretlist.php"});d("get_comment",{url:b+"/public/aj_commentlist.php"});d("getmblog",{url:b+"/topics/aj_votecontent.php"});d("getcard",{url:b+"/public/aj_namecard.php"});d("getweekrank",{url:b+"/topics/aj_weekrank.php"});d("block",{url:b+"/topics/aj_operateblockid.php",method:"post"});return c});
STK.register("common.topic.login",function(a){function n(){var b=a.sizzle('div[class="WB_widget WB_tips_top"]',o);if(b.length>0)var c=setTimeout(function(){a.removeNode(b[0]);clearTimeout(c);c=null},3e3)}function m(){if(d!=!0){d=!0;var b=a.common.trans.topic.getTrans("person_info",{onComplete:function(b){var c,e;switch(b.code){case"100000":b.data&&b.data.name&&(a.bLength(b.data.name)>10?b.data.shortname=a.leftB(b.data.name,8)+"…":b.data.shortname=b.data.name);b.data.icon?e=j.replace(/###(\w+)###/g,function(a,c){return b.data[c]}):b.data.name?e=l:e=k;e=a.core.util.easyTemplate(e,b.data)}o.innerHTML=e;d=null},onFail:function(){d=null}});b.request({wsrc:$CONFIG.wsrc||"app_topic_base"})}}var b,c,d,e=location.host,f=a.kit.extra.language,g="http://service.weibo.com/reg/loginindex.php?appsrc=1lzBEX&backurl=http%3A%2F%2F"+e+"%2Fwidget%2Fpublic%2FloginProxy.html&vsrc=app_cmtbox&showlogo=0",h="http://weibo.com/signup/signup.php?vsrc=app_widget_topic_width&backurl=http%3A%2F%2F"+e+"%2Fwidget%2Fpublic%2FloginProxy.html&from=zw&showlogo=0&appsrc=1lzBEX",i="http://weibo.com/signup/full_info.php?appsrc=1lzBEX&backurl=http%3A%2F%2Fweibo.com&showlogo=0&vsrc=app_sharepop&diy=&from=zw&regbackurl=http%3A%2F%2F&c=&refer=http%3A%2F%2F",j=f('<u class="status_icon status_beginner"></u> <a class="user_name" href="http://weibo.com/u/###uid###" target="_blank" title="">###shortname###</a><cite class="WB_vline">|</cite><a class="logout_link" action-type="logout" href="http://weibo.com/logout" onclick="return false;" title="">#L{退出}</a>'),k=f('<u class="status_icon status_beginner"></u> <a class="user_name" action-type="login" href="'+g+'" onclick="return false;" title="">#L{登录}</a>'+'<cite class="WB_vline">|</cite>'+'<a class="logout_link" action-type="regist" href="'+h+'" onclick="return false;" title="">#L{注册}</a>'),l=f('<u class="status_icon status_beginner"></u> <a class="user_name" href="#" onclick="return false;" title="">###NICK###</a>（#L{您的帐号尚未开通微博}）<a class="WB_btngB" href="'+i+'" onclick="return false;" action-type="fullinfo"><span>#L{立即开通}</span></a>'+'<cite class="WB_vline">|</cite>'+'<a class="logout_link" action-type="logout" href="http://weibo.com/logout" onclick="return false;" title="">#L{退出}</a>'),o;return{init:function(a,b){if(a!=null){o=a;n()}},login:function(a,b){window.App=window.App||{};App.loginBackUrlCallBack=function(){if(b){b();m()}else location.reload();try{var a=scope.loginKit().uid,c=$CONFIG.refer||""}catch(d){}};var c=g;location.host=="widget.weibo.com"&&(c="http://service.weibo.com/reg/loginindex.php?appsrc="+$CONFIG.app_src+"&backurl="+encodeURIComponent("http://widget.weibo.com/public/loginProxy.html")+"&vsrc=app_topic&showlogo=0");var d=window.open(c,"login","width=750,height=620")},logout:function(){STK.logonBack=function(){window.location.reload()};var b="http://"+location.host+"/ajaxlogin.php";/^service./.test(location.host)&&(b="http://"+location.host+"/sso/login.php");location.host=="widget.weibo.com"&&(b="http://widget.weibo.com/public/logout.php");tempDiv=a.C("div");tempDiv.style.cssText="width:1px;height:1px;overflow:hidden;position:absolute;left:-1000px;top:-1000px;";var c=a.C("iframe");c.src="http://weibo.com/logout.php?backurl="+encodeURIComponent(b+"?framelogin=1&callback=parent.STK.logonBack&rnd="+Math.random());c.onload=function(){o.innerHTML=k};tempDiv.appendChild(c);document.body.appendChild(tempDiv)},regist:function(a,b){window.App=window.App||{};App.loginBackUrlCallBack=function(){if(b){b();m()}else location.reload()};var c=h;window.open(c,"regist","width=950,height=620")},fullinfo:function(a){if(typeof $CONFIG!="undefined"&&typeof $CONFIG.is_sina_user!="undefined"&&$CONFIG.is_sina_user=="1"){if(a!=!1){var b=i;window.open(b,"fullinfo","width=950,height=620")}return!1}return!0},close:function(){var b=a.sizzle('div[class="WB_widget WB_tips_top"]',o);b.length>0&&a.removeNode(b[0])}}});
STK.register("comp.topic.login",function(a){var b=a.kit.extra.language;return function(b,c){var d={},e,f,g=a.common.topic.login,h=function(){i();j();k();l();m();n()},i=function(){if(b==null||b!=null&&!a.core.dom.isNode(b))throw"[comp.topic.login]:argsCheck()-The param node is not a DOM node.";c=a.core.obj.parseParam({html:""},c)},j=function(){f=a.kit.dom.parseDOM(a.builder(b).list)},k=function(){g.init(b);e=a.core.evt.delegatedEvent(b);e.add("login","click",g.login);e.add("logout","click",g.logout);e.add("regist","click",g.regist);e.add("fullinfo","click",g.fullinfo);e.add("close","click",g.close)},l=function(){},m=function(){},n=function(){},o=function(){};h();d.destroy=o;return d}});
STK.pageletM.register("pl.topic.login",function(a){var b={},c=a.E("pl_topic_login"),d=a.comp.topic.login(c,b);return d});
STK.register("kit.dom.isTurnoff",function(a){return function(a){return!a.parentNode||a.parentNode.nodeType==11||!!a.disabled}});
STK.register("kit.extra.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c)try{return a.selectionStart}catch(b){return 0}var d=c.createRange(),e,f,g=0,h=document.body.createTextRange();h.moveToElementText(a);for(g;h.compareEndPoints("StartToStart",d)<0;g++)h.moveStart("character",1);return g};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c)a.setSelectionRange(b,d);else{var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()}};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i)}else{var j=c.createRange();j.moveStart("character",-f);j.text=d}};b.replaceText=function(a,d){a.focus();var e=a.value,f=b.getSelectedText(a),g=f.length;if(f.length==0)b.insertText(a,d,b.getCursorPos(a));else{var h=b.getCursorPos(a);if(!c){var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStart=e.text.length-d.text.length;a.selectionEnd=a.selectionStart+d.text.length;b=a.selectionStart}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};b.getSelectedText=function(a){var b="",d=function(a){return a.selectionStart!=undefined&&a.selectionEnd!=undefined?a.value.substring(a.selectionStart,a.selectionEnd):""};window.getSelection?b=d(a):b=c.createRange().text;return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else a.setSelectionRange(b,b+c)};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("kit.extra.count",function(a){function b(b){var c=41,d=140,e=20,f=b,g=b.match(/http:\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}return function(a){a=a.replace(/\r\n/g,"\n");return num=b(a)}});
STK.register("module.editor",function(a){var b=a.core.evt.addEvent,c=a.core.evt.custEvent,d=a.core.dom.getStyle,e=a.core.dom.setStyle;return function(b,c){var d={},c=c,e={},f={reset:function(){e.textEl.value="";a.core.evt.custEvent.fire(d,"changed");e.textEl.removeAttribute("extra")},delWords:function(a){var b=f.getWords();if(!(b.indexOf(a)>-1))return!1;e.textEl.value="";h.textInput(b.replace(a,""))},getWords:function(){return a.core.str.trim(e.textEl.value)},getExtra:function(){var b,c=e.textEl.getAttribute("extra")||"";c!=null&&(b=a.core.str.trim(c));return b},focus:function(b,c){if(typeof b!="undefined")a.kit.extra.textareaUtils.setCursor(e.textEl,b,c);else{var d=e.textEl.value.length;a.kit.extra.textareaUtils.setCursor(e.textEl,d)}g.cacheCurPos()},blur:function(){e.textEl.blur()},addExtraInfo:function(a){typeof a=="string"&&e.textEl.setAttribute("extra",a)},disableEditor:function(a){a===!0?e.textEl.setAttribute("disabled","disabled"):e.textEl.removeAttribute("disabled")},getCurPos:function(){var a=e.textEl.getAttribute("range")||"0&0";return a.split("&")},count:function(){var b=a.core.str.trim(e.textEl.value).length==0?a.core.str.trim(e.textEl.value):e.textEl.value;return a.kit.extra.count(b)}},g={textElFocus:function(){e.recommendTopic&&a.core.dom.setStyle(e.recommendTopic,"display","none");a.custEvent.fire(d,"focus");e.num&&a.core.dom.setStyle(e.num,"display","block");f.getWords()==c.tipText&&f.delWords(c.tipText)},textElBlur:function(){setTimeout(function(){if(e.textEl.value.length===0){e.recommendTopic&&a.core.dom.setStyle(e.recommendTopic,"display","block");e.num&&e.recommendTopic&&a.core.dom.setStyle(e.num,"display","none");a.custEvent.fire(d,"blur");typeof c.tipText!="undefined"&&(e.textEl.value=c.tipText)}},50)},cacheCurPos:function(){var b=a.kit.extra.textareaUtils.getSelectedText(e.textEl),c=b==""||b==null?0:b.length,d=a.kit.extra.textareaUtils.getCursorPos(e.textEl),f=d+"&"+c;e.textEl.setAttribute("range",f)}},h={textChanged:function(){a.custEvent.fire(d,"keyUpCount")},textInput:function(b,h){var i=f.getCurPos(),h=i[0],j=i[1];f.getWords()==c.tipText&&b!=c.tipText&&f.delWords(c.tipText);a.kit.extra.textareaUtils.unCoverInsertText(e.textEl,b,{rcs:i[0],rccl:i[1]});g.cacheCurPos();a.core.evt.custEvent.fire(d,"changed")}},i={},j=function(){m();n()},k=function(){o();q();r();l()},l=function(){c.storeWords?e.textEl.value.length==0&&h.textInput(c.storeWords):c.tipText&&(e.textEl.value=c.tipText)},m=function(){if(!b)throw"node is not defined in module editor"},n=function(){var c=a.core.dom.builder(b).list;e=a.kit.dom.parseDOM(c)},o=function(){a.core.evt.addEvent(e.textEl,"focus",g.textElFocus);a.core.evt.addEvent(e.textEl,"blur",g.textElBlur);a.core.evt.addEvent(e.textEl,"mouseup",g.cacheCurPos);a.core.evt.addEvent(e.textEl,"keyup",g.cacheCurPos)},p=function(){a.core.evt.custEvent.define(d,"changed")},q=function(){p();a.core.evt.custEvent.add(d,"changed",h.textChanged)},r=function(){},s=function(){};j();var t={reset:f.reset,getWords:f.getWords,getExtra:f.getExtra,delWords:f.delWords,focus:f.focus,blur:f.blur,insertText:h.textInput,check:h.textChanged,addExtraInfo:f.addExtraInfo,disableEditor:f.disableEditor,getCurPos:f.getCurPos,count:f.count};d.destroy=s;d.API=t;d.nodeList=e;d.init=k;d.opts=c;return d}});
STK.register("common.editor.plugin.count",function(a){function e(a,b){if(!a.textEl)throw"[editor plugin count]: plz check nodeList"}function d(a){var d=c(a),e=Math.abs(b-d),f;d>b||d<1?f={wordsnum:d,vnum:e,overflow:!0}:d==0?f={wordsnum:d,vnum:e,overflow:!0}:f={wordsnum:d,vnum:e,overflow:!1};return f}function c(b){var c=41,d=140,e=20,f=b,g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}var b;return function(c){var f=c.nodeList,g,h=c.opts,i=a.kit.extra.language;b=h.limitNum;e(f);a.custEvent.define(c,"textNum");a.custEvent.define(c,"keyUpCount");var j=f.textEl,k=f.num;a.addEvent(j,"focus",function(){g=setInterval(function(){l()},200)});a.addEvent(j,"blur",function(){clearInterval(g)});var l=function(){var b=a.core.str.trim(j.value).length==0?a.core.str.trim(j.value):j.value,e=c&&c.opts&&c.opts.extendText;b=b.replace(/\r\n/g,"\n");var f=d(b,h.limitNum);b.length>=0&&j.focus?f.overflow&&f.wordsnum!=0?k.innerHTML=(e?i(e):"")+i("#L{已经超过}")+'<span class="W_error">'+f.vnum+"</span>字":k.innerHTML=(e?i(e):"")+i("#L{还可以输入}")+"<span>"+f.vnum+"</span>字":b.length===0&&(k.innerHTML=(e?i(e):"")+i("#L{还可以输入}")+"<span>"+f.vnum+"</span>字");a.core.evt.custEvent.fire(c,"textNum",{count:f.wordsnum,isOver:f.overflow})};STK.core.evt.addEvent(j,"keyup",l);a.custEvent.add(c,"keyUpCount",l)}});
STK.register("kit.dom.cssText",function(a){var b=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i)))c=c.replace(d[1]+d[2]+d[3],"");return c};return function(a){a=a||"";var c=[],d={push:function(a,b){c.push(a+":"+b);return d},remove:function(a){for(var b=0;b<c.length;b++)c[b].indexOf(a+":")==0&&c.splice(b,1);return d},getStyleList:function(){return c.slice()},getCss:function(){return b(a,c.join(";"))}};return d}});
STK.register("module.at",function(a){var b=window,c=document,d=a.core.util.browser,e="font-family:Tahoma,宋体;",f=a.kit.extra.textareaUtils.selectionStart,g,h,i,j,k,l=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',e,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',e,'"> </span>'].join("")};return function(b){var c=b.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(b){return a[b]});return c}}(),m=function(){var b=[],c=g.textEl.style.cssText,d;a.foreach(["margin","padding","border"],function(c){a.foreach(["Top","Left","Bottom","Right"],function(d){var e;c!="border"?e=b.push(c,"-",d.toLowerCase(),":",a.getStyle(g.textEl,c+d),";"):a.foreach(["Color","Style","Width"],function(e){b.push(c,"-",d.toLowerCase(),"-",e.toLowerCase(),":",a.getStyle(g.textEl,[c,d,e].join("")),";")})})});b.push("font-size:"+a.getStyle(g.textEl,"fontSize")+";");return a.kit.dom.cssText([c,b.join(""),e,"word-wrap: break-word;line-height: 18px;overflow-y:auto;overflow-x:hidden;outline:none;"].join("")).getCss()},n=function(){var b=a.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list,e=b.wrap[0],f=b.flag[0],h=b.after[0],i=b.before[0],j=0,n,o,p,q=function(a){return d.MOZ?-2:d.MOBILE&&d.SAFARI&&(d.IPAD||d.ITOUCH||d.IPHONE)?-2:0};return{bind:function(){if(o!==g.textEl){k=a.position(g.textEl);var b=["left:",k.l,"px;top:",k.t+20,"px;"].join("");o=g.textEl;var d=m();o.style.cssText=d;p=[b,d,"position:absolute;filter:alpha(opacity=0);opacity:0;z-index:-1000;"].join("");e.style.cssText=p;if(!j){j=1;c.body.appendChild(e)}}},content:function(b,c,d,j){e.style.cssText=[p,"width:",(o.offsetWidth||parseInt(a.getStyle(o,"width")))+q(),"px;height:",o.offsetHeight||parseInt(a.getStyle(o,"height")),"px;overflow-x:hidden;overflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":a.getStyle(o,"overflowY"),";"].join("");i.innerHTML=l(b);f.innerHTML=l(c)||"&thinsp;";h.innerHTML=l([d,j].join(""));clearTimeout(n);n=setTimeout(function(){var b=a.position(f);a.custEvent.fire(g.eId,"at",{t:b.t-o.scrollTop-k.t+5,l:b.l-k.l+5,key:d,flag:c,textarea:g.textEl})},30)},hide:function(){e.style.display="none"},show:function(){e.style.display=""}}}(),o=function(){if(a.kit.dom.isTurnoff(g.textEl))clearInterval(h);else{var b=g.textEl.value.replace(/\r/g,""),c=f(g.textEl);if(c<0||c==j)return;j=c;var d=b.slice(0,c),e=d.match(new RegExp(["(",g.flag,")([a-zA-Z0-9一-龥_]{0,20})$"].join("")));if(!e){a.custEvent.fire(g.eId,"hidden");return}var i=b.slice(c);d=d.slice(0,-e[0].length);n.content(d,e[1],e[2],i)}};return function(b){if(!!b&&!!b.textEl){b=a.parseParam({textEl:null,flag:"@",eId:a.custEvent.define({},["at","hidden"])},b);var c=function(){if(!!g){clearInterval(h);a.removeEvent(g.textEl,"blur",c);n.hide()}},d=function(){c();g=b;j=null;n.bind();n.show();h=setInterval(o,200);a.addEvent(b.textEl,"blur",c)};a.addEvent(b.textEl,"focus",d);return b.eId}}});
STK.register("common.trans.editor",function(a){var b=location.host=="widget.weibo.com"||location.host=="dev.weibo.com"?"":"/widget",c=a.kit.io.inter(),d=c.register;d("face",{url:b+"/public/aj_getemotions.php"});d("at",{url:b+"/public/aj_atusers.php"});return c});
STK.register("module.suggest",function(a){var b=null,c=a.custEvent,d=c.define,e=c.fire,f=c.add,g=a.addEvent,h=a.removeEvent,i=a.stopEvent,j=[],k={},l={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9},m=function(b){var c=-1,j=[],k=b.textNode,m=b.uiNode,n=a.core.evt.delegatedEvent(m),o=d(k,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);o.setFlag=p;var p=function(a){b.flag=a},q=function(){return a.sizzle(["[action-type=",b.actionType,"]"].join(""),m)},r=function(){c=-1;h(k,"keydown",s);n.destroy()},s=function(a){var d,f;if(!!(d=a)&&!!(f=d.keyCode)){if(f==l.ENTER){i();e(o,"onSelect",[c,k,b.flag]);return!1}if(f==l.UP){i();var g=q().length;c=c<1?g-1:c-1;e(o,"onIndexChange",[c]);return!1}if(f==l.DOWN){i();var g=q().length;c=c==g-1?0:c+1;e(o,"onIndexChange",[c]);return!1}if(f==l.ESC){i();r();e(o,"onClose");return!1}if(f==l.TAB){r();e(o,"onClose");return!1}}},t=function(c){e(o,"onSelect",[a.core.arr.indexOf(c.el,q()),k,b.flag])},u=function(b){c=a.core.arr.indexOf(b.el,q());e(o,"onIndexChange",[a.core.arr.indexOf(b.el,q())])};f(o,"open",function(a,c){k=c;r();g(c,"keydown",s);n.add(b.actionType,"mouseover",u);n.add(b.actionType,"click",t);e(o,"onOpen",[b.flag])});f(o,"openSetFlag",function(a,b){p(b)});f(o,"close",function(){r();e(o,"onClose",[b.flag])});f(o,"indexChange",function(a,d){c=d;e(o,"onIndexChange",[c,b.flag])});return o},n=function(b){var c=b.textNode,d=a.core.arr.indexOf(c,j);if(!k[d]){j[d=j.length]=c;k[d]=m(b)}return k[d]};return function(c){if(!!c.textNode&&!!c.uiNode){c=a.parseParam({textNode:b,uiNode:b,actionType:"item",actionData:"index",flag:""},c);return n(c)}}});
STK.register("common.channel.at",function(a){var b=["open","close"];return a.common.listener.define("common.channel.at",b)});
STK.register("kit.dom.firstChild",function(a){var b=a.core.dom.next;return function(a){var c=a.firstChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("kit.dom.layoutPos",function(a){return function(b,c,d){if(!a.isNode(c))throw"kit.dom.layerOutElement need element as first parameter";if(c===document.body)return!1;if(!c.parentNode)return!1;if(c.style.display==="none")return!1;var e,f,g,h,i,j,k;e=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},d);f=c;if(!f)return!1;while(f!==document.body){f=f.parentNode;if(f.style.display==="none")return!1;j=a.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed")break;if(k==="true"&&j==="relative")break}f.appendChild(b);g=a.position(c,{parent:f});h={w:c.offsetWidth,h:c.offsetHeight};i=e.pos.split("-");i[0]==="left"?b.style.left=g.l+e.offsetX+"px":i[0]==="right"?b.style.left=g.l+h.w+e.offsetX+"px":i[0]==="center"&&(b.style.left=g.l+h.w/2+e.offsetX+"px");i[1]==="top"?b.style.top=g.t+e.offsetY+"px":i[1]==="bottom"?b.style.top=g.t+h.h+e.offsetY+"px":i[1]==="middle"&&(b.style.top=g.t+h.h/2+e.offsetY+"px");return!0}});
STK.register("common.editor.plugin.at",function(a){var b=a.kit.extra.language,c='<div class="WB_tips_smart WB_email"><p class="tipsmt_title" node-type="suggestTitle">想用@提到谁</p><ul class="tipsmt_list" node-type="suggestWrap"></ul></div>',d={"@":{normalTitle:b("#L{选择昵称或轻敲空格完成输入}"),moreTitle:b("#L{选择最近@的人或直接输入}"),noTilte:b("#L{轻敲空格完成输入}")},"#":{normal:b("#L{想用什么话题？}")}},e={"@":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="tipsmt_cur" </#if>action-data="value=${list.nickname}" value="${list.nickname}"><a href="#">${list.nickname}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}"><a href="#">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'},f,g,h,i,j,k,l,m=!1,n,o,p={"@":"at","#":"topicList"},q=0,r=function(){setTimeout(function(){a.custEvent.fire(f,"close")},200)},s=function(){k.style.display="none"},t=function(){a.custEvent.add(f,"onIndexChange",function(a,b){y(b)});a.custEvent.add(f,"onSelect",function(b,c,d,e){q=0;a.core.evt.stopEvent();var g=o[c].getAttribute("value");g=g.replace(/\(.*\)/,"");try{d.focus()}catch(h){}var i=a.kit.extra.textareaUtils.selectionStart(d)*1,j=new RegExp(e+"([a-zA-Z0-9一-龥_]{0,20})$"),k=d.value.replace(/\r+/g,"").slice(0,i).match(j),l=d.value.slice(i,i+1);k=k&&k[1]?k[1].length:0;var m=a.kit.extra.textareaUtils;e=="#"?typeof l!="undefined"&&l!=e&&(g=g+e+" "):g=g+" ";m.insertText(d,g,i,k);var n=m.getCursorPos(d);if(e=="#"&&l==e){m.setCursor(d,n+1);m.insertText(d," ",n+1,0)}n=m.getCursorPos(d);var p=m.getSelectedText(d),r=p==""||p==null?0:p.length;d.setAttribute("range",n+"&"+r);a.custEvent.fire(f,"close")});a.addEvent(h.textEl,"blur",r);a.custEvent.add(f,"onClose",s);a.custEvent.add(f,"onOpen",function(b,c){j.style.display="";k.style.display="";m=!0;setTimeout(function(){a.custEvent.fire(f,"indexChange",0)},100)})},u=function(b,c,f){b=="@"?c.data&&c.data.length>0?c.title=f==""?d[b].moreTitle:d[b].normalTitle:c.title=d[b].noTilte:c.title=d[b].normalTitle;var g=a.core.util.easyTemplate(e[b],c);return g},v=function(){a.core.evt.custEvent.add(g,"hidden",function(b,c){a.custEvent.fire(f,"close")});a.core.evt.custEvent.add(g,"at",function(b,c){l=c.key;var e=c.flag;if(l.length==0&&e!="@")a.custEvent.fire(f,"close");else{var g=document.location.host=="widget.weibo.com"?"":"/widget";a.core.io.ajax({url:g+"/public/aj_atusers.php",args:{wsrc:$CONFIG.wsrc||"app_comment_box",appkey:$CONFIG.source_appkey||$CONFIG.appkey||$CONFIG.app_src,q:l},onComplete:function(b){if(b.code=="100000"){var g=u(e,b,l);a.custEvent.fire(f,"openSetFlag",e);a.custEvent.fire(f,"open",c.textarea);var h=a.core.dom.builder(g),m=h.box;j.innerHTML=m;j.style.display=b.data.length==0?"none":"";i.innerHTML=l.length==0?d["@"].moreTitle:d["@"].normalTitle;k.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");a.common.channel.at.fire("open");a.kit.dom.layoutPos(k,c.textarea,{pos:"left-top",offsetX:c.l,offsetY:c.t})}else a.custEvent.fire(f,"close")},onFail:function(){a.custEvent.fire(f,"close")}})}})},w=function(){n=h.textEl;g=STK.module.at({textEl:n,flag:"@"})},x=function(b){q=0;k&&(k.style.display="none");k&&(k.innerHTML="");var d=a.builder(c);k=a.kit.dom.firstChild(d.box);k.style.display="none";document.body.appendChild(k);i=d.list.suggestTitle[0];j=d.list.suggestWrap[0];f&&a.custEvent.fire(f,"close");f&&a.custEvent.remove(f);f=a.module.suggest({textNode:b,uiNode:j,actionType:"item",actionData:"value",flag:"@"});t()},y=function(b){o=a.sizzle("li",j);o&&o[0]&&a.core.dom.removeClassName(o[q],"tipsmt_cur");a.core.dom.addClassName(o[b],"tipsmt_cur");q=b};return function(a,b){h=a.nodeList;var c={};c.init=function(){w();x(h.textEl);v()};return c}});
STK.register("common.editor.base",function(a){var b={limitNum:140};return function(c,d){var e={},f,g,h,i;f=a.kit.extra.merge(b,d);g=a.module.editor(c,f);h=g.nodeList;i=[];if(typeof d.count=="undefined"||d.count=="enable")var j=a.common.editor.plugin.count(g,f);if(f.atSwitch!=null&&f.atSwitch==!0){var k=a.common.editor.plugin.at(g,f);k.init()}g.init();g.widget=function(a,b,c){i.push(a);a.init(g,b,c);return g};g.closeWidget=function(){if(i&&i.length!=0)for(var a=0,b=i.length;a<b;a++)i[a].hide()};return g}});
STK.register("module.layer",function(a){var b=function(a){var b={};if(a.style.display=="none"){a.style.visibility="hidden";a.style.display="";b.w=a.offsetWidth;b.h=a.offsetHeight;a.style.display="none";a.style.visibility="visible"}else{b.w=a.offsetWidth;b.h=a.offsetHeight}return b},c=function(c,d){d=d||"topleft";var e=null;if(c.style.display=="none"){c.style.visibility="hidden";c.style.display="";e=a.core.dom.position(c);c.style.display="none";c.style.visibility="visible"}else e=a.core.dom.position(c);if(d!=="topleft"){var f=b(c);if(d==="topright")e.l=e.l+f.w;else if(d==="bottomleft")e.t=e.t+f.h;else if(d==="bottomright"){e.l=e.l+f.w;e.t=e.t+f.h}}return e};return function(d){var e=a.core.dom.builder(d),f=e.list.outer[0],g=e.list.inner[0],h=a.core.dom.uniqueID(f),i={},j=a.core.evt.custEvent.define(i,"show");a.core.evt.custEvent.define(j,"hide");var k=null;i.show=function(){f.style.display="";a.core.evt.custEvent.fire(j,"show");return i};i.hide=function(){f.style.display="none";a.custEvent.fire(j,"hide");return i};i.getPosition=function(a){return c(f,a)};i.getSize=function(a){if(a||!k)k=b.apply(i,[f]);return k};i.html=function(a){a!==undefined&&(g.innerHTML=a);return g.innerHTML};i.text=function(b){text!==undefined&&(g.innerHTML=a.core.str.encodeHTML(b));return a.core.str.decodeHTML(g.innerHTML)};i.appendChild=function(a){g.appendChild(a);return i};i.getUniqueID=function(){return h};i.getOuter=function(){return f};i.getInner=function(){return g};i.getParentNode=function(){return f.parentNode};i.getDomList=function(){return e.list};i.getDomListByKey=function(a){return e.list[a]};i.getDom=function(a,b){return e.list[a]?e.list[a][b||0]:!1};i.getCascadeDom=function(b,c){return e.list[b]?a.core.dom.cascadeNode(e.list[b][c||0]):!1};return i}});
STK.register("module.bubble",function(a){return function(b,c){if(!b)throw"module.bubble need template as first parameter";var d,e,f,g,h,i,j;e=a.parseParam({width:null,height:null,parent:document.body},c);f=a.module.layer(b);g=f.getDom("outer");h=f.getDom("inner");f.getDomListByKey("close")&&(i=f.getDom("close"));g.style.display="none";j=!1;var k=function(b){if(j)return!0;var c=a.fixEvent(b);a.contains(g,c.target)||f.hide()};i&&a.addEvent(i,"click",f.hide);a.custEvent.add(f,"show",function(){setTimeout(function(){a.addEvent(document.body,"click",k)},0)});a.custEvent.add(f,"hide",function(){j=!1;a.removeEvent(document.body,"click",k)});d=f;d.setPosition=function(a){g.style.top=a.t+"px";g.style.left=a.l+"px";return d};d.setLayout=function(b,c){if(!a.isNode(b))throw"module.bubble.setDown need element as first parameter";a.kit.dom.layoutPos(g,b,c);return d};d.setContent=function(b){typeof b=="string"?h.innerHTML=b:a.isNode(b)&&h.appendChild(b);return d};d.setArrow=function(a){var b;if(f.getDomListByKey("arrow")){b=f.getDom("arrow");b.className=a.className||"";b.style.cssText=a.style||""}};d.clearContent=function(){while(h.children.length)a.removeNode(h.children[0])};d.stopBoxClose=function(){j=!0};d.startBoxClose=function(){j=!1};d.destroy=function(){a.removeEvent(document.body,"click",k);f=null;g=null;h=null;i=null};return d}});
STK.register("ui.bubble",function(a){var b='<div class="W_layer" node-type="outer"><div class="bg"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content"><a class="W_close" href="javascript:void(0);" node-type="close" title="关闭"></a><div node-type="inner"></div></div></td></tr></tbody></table><div class="arrow arrow_t"></div></div></div>',c=[],d=function(d){var f=a.module.bubble(b,d);a.custEvent.add(f,"hide",function(){g(f);e(f)});c.push({bub:f,used:!0});return f},e=function(a){a.clearContent();document.body.appendChild(a.getOuter())},f=function(a){for(var b=0,d=c.length;b<d;b+=1)if(a===c[b].bub){c[b].used=!0;return}},g=function(a){for(var b=0,d=c.length;b<d;b+=1)if(a===c[b].bub){c[b].used=!1;return}},h=function(a){var b;for(var e=0,f=c.length;e<f;e+=1)if(!c[e].used){c[e].used=!0;b=c[e].bub;return b}b=d(a);return b};return function(b){return h(a.parseParam({},b))}});
STK.register("common.bubble.face",function(a){function q(b){b=b||h;n(b);var c=-9,e=3;if(k){c=-10;e=5}a.kit.dom.layoutPos(d.getOuter(),j,{pos:"left-bottom",offsetX:c,offsetY:e});d.show()}function p(b){var c=a.common.trans.editor.getTrans("face",{onSuccess:function(a,c){if(parseInt(a.code)==1e5&&a.data&&a.data.usual&&a.data.usual.norm){h=a.data.usual.norm;b&&b(h)}}});c.request({wsrc:$CONFIG.wsrc||"app_topic_base",appkey:$CONFIG.appkey||"",type:"face"})}function m(){g.remove("emotion","click")}var b='<#et userlist data><div node-type="outer" class="WB_widgets WB_tips_show" style="position:absolute;"><span action-type="close" class="ts_arr"></span><div class="layer_faces"> <a href="#" onclick="return false;" action-type="close" class="WB_tips_show_close" title="关闭">关闭</a> <!-- 内容区 --><div class="tipsshow_detail" node-type="inner"><ul class="faces_list clearfix"><#list data.emotions as item><li action-type="emotion" action-data="text=${item.phrase}"><img src="${item.icon}" alt="${item.phrase}" title="${item.phrase}" /></li></#list></ul></div><!-- /内容区 --> </div></div>',c='<#et userlist data><div node-type="outer" class="WB_widget WB_widget_layer" style="z-index:9999"><table><tbody><tr><td><div class="layer_shadow"><div class="layer_inner_container"><div class="layer_content"><div class="faces_list_container" node-type="inner"><ul class="faces_list clearfix"><#list data.emotions as item><li class="faces_item" action-type="emotion" action-data="text=${item.phrase}"><img src="${item.icon}" alt="${item.phrase}" title="${item.phrase}" /></li></#list></ul></div></div><a title="" action-type="close" href="javascript:;" class="layer_close_btn layer_close_btn_large"></a></div><div class="layer_inner_arrow layer_inner_arrow_gray" style="left:14px"></div></div><div class="layer_shadow_arrow" style="left:12px"></div></td></tr></tbody></table></div>',d,e,f,g,h,i,j,k;i={};a.custEvent.define(i,"insert");a.custEvent.define(i,"hide");var l={close:function(b){a.custEvent.fire(i,"hide")},emotion:function(b){a.custEvent.fire(i,"insert",{value:b.data.text});a.custEvent.fire(i,"hide")}},n=function(e){e=e||{};var f=k?c:b,g=a.core.util.easyTemplate(f),h=g({emotions:e}).toString();d=a.module.layer(h);n=function(){};o()},o=function(){g=a.core.evt.delegatedEvent(d.getOuter());g.add("emotion","click",l.emotion);g.add("close","click",l.close);o=function(){}};i.getBub=function(){return d};return function(b,c){if(!a.isNode(b))throw"common.bubble.face need el as first parameter!";j=b;var d=a.parseParam({l:0,latest:!1},c);k=d.latest;h==null?p(q):q();return i}});
STK.register("common.editor.widget.face",function(a){return function(b){var c={},d,e,f,g;g=a.parseParam({t:0,l:-15,latest:!1},b);var h=function(a,b){d.API.insertText(b.value);e.getBub().hide()},i=function(){a.core.evt.stopEvent();a.custEvent.remove(e,"insert",h);a.core.evt.preventDefault();e=a.common.bubble.face(d.nodeList[f],g);a.custEvent.add(e,"insert",h);a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);a.custEvent.remove(e,"insert",h);c.hide()});a.core.evt.custEvent.fire(c.custKeyShow,"show",["face"])};c.init=function(b,c,e){d=b;f=c;a.addEvent(b.nodeList[f],"click",i)};c.clear=function(){};c.show=function(){};c.hide=function(){e&&e.getBub&&e.getBub().hide&&e.getBub().hide()};c.destroy=function(){d=null;a.custEvent.undefine(c)};c.custKeyShow=a.core.evt.custEvent.define(c,"show");return c}});
STK.register("kit.extra.reuse",function(a){return function(b,c){var d,e,f;d=a.parseParam({},c);f=[];var g=function(){var a=b();f.push({store:a,used:!0});return a},h=function(b){a.foreach(f,function(a,c){if(b===a.store){a.used=!0;return!1}})},i=function(b){a.foreach(f,function(a,c){if(b===a.store){a.used=!1;return!1}})},j=function(){for(var a=0,b=f.length;a<b;a+=1)if(f[a].used===!1){f[a].used=!0;return f[a].store}return g()};e={};e.setUsed=h;e.setUnused=i;e.getOne=j;e.getLength=function(){return f.length};return e}});
STK.register("module.dialog",function(a){return function(b,c){if(!b)throw"module.dialog need template as first parameter";var d,e,f,g,h,i,j,k,l,m,n,o;l=!0;var p=function(){l!==!1&&e.hide()},q=function(){d=a.parseParam({t:null,l:null,width:null,height:null},c);e=a.module.layer(b,d);g=e.getOuter();h=e.getDom("title");k=e.getDom("title_content");i=e.getDom("inner");j=e.getDom("close");a.addEvent(j,"click",function(){n()});a.custEvent.add(e,"show",function(){a.hotKey.add(document.documentElement,["esc"],p,{type:"keyup",disableInInput:!0})});a.custEvent.add(e,"hide",function(){a.hotKey.remove(document.documentElement,["esc"],p,{type:"keyup"});l=!0})};q();o=a.objSup(e,["show","hide"]);n=function(b){if(typeof m=="function"&&!b&&m()===!1)return!1;o.hide();a.contains(document.body,e.getOuter())&&document.body.removeChild(e.getOuter());return f};f=e;f.show=function(){a.contains(document.body,e.getOuter())||document.body.appendChild(e.getOuter());o.show();return f};f.hide=n;f.setPosition=function(a){g.style.top=a.t+"px";g.style.left=a.l+"px";return f};f.setMiddle=function(){var b=a.core.util.winSize(),c=e.getSize(!0);g.style.top=a.core.util.scrollPos().top+(b.height-c.h)/2+"px";g.style.left=(b.width-c.w)/2+"px";return f};f.setTitle=function(a){k.innerHTML=a;return f};f.setContent=function(a){typeof a=="string"?i.innerHTML=a:i.appendChild(a);return f};f.clearContent=function(){while(i.children.length)a.removeNode(i.children[0]);return f};f.setAlign=function(){};f.setBeforeHideFn=function(a){m=a};f.clearBeforeHideFn=function(){m=null};f.unsupportEsc=function(){l=!1};f.supportEsc=function(){l=!0};return f}});
STK.register("kit.dom.fix",function(a){function f(c,e,f){if(!!d(c)){var g="fixed",h,i,j,k,l=c.offsetWidth,m=c.offsetHeight,n=a.core.util.winSize(),o=0,p=0,q=a.kit.dom.cssText(c.style.cssText);if(!b){g="absolute";var r=a.core.util.scrollPos();o=h=r.top;p=i=r.left;switch(e){case"lt":h+=f[1];i+=f[0];break;case"lb":h+=n.height-m-f[1];i+=f[0];break;case"rt":h+=f[1];i+=n.width-l-f[0];break;case"rb":h+=n.height-m-f[1];i+=n.width-l-f[0];break;case"c":default:h+=(n.height-m)/2+f[1];i+=(n.width-l)/2+f[0]}j=k=""}else{h=k=f[1];i=j=f[0];switch(e){case"lt":k=j="";break;case"lb":h=j="";break;case"rt":i=k="";break;case"rb":h=i="";break;case"c":default:h=(n.height-m)/2+f[1];i=(n.width-l)/2+f[0];k=j=""}}if(e=="c"){h<o&&(h=o);i<p&&(i=p)}q.push("position",g).push("top",h+"px").push("left",i+"px").push("right",j+"px").push("bottom",k+"px");c.style.cssText=q.getCss()}}function e(b){b=a.core.arr.isArray(b)?b:[0,0];for(var c=0;c<2;c++)typeof b[c]!="number"&&(b[c]=0);return b}function d(b){return a.core.dom.getStyle(b,"display")!="none"}var b=!(a.core.util.browser.IE6||document.compatMode!=="CSS1Compat"&&STK.IE),c=/^(c)|(lt)|(lb)|(rt)|(rb)$/;return function(d,g,h){var i,j,k=!0,l;if(a.core.dom.isNode(d)&&c.test(g)){var m={getNode:function(){return d},isFixed:function(){return k},setFixed:function(a){(k=!!a)&&f(d,i,j);return this},setAlign:function(a,b){if(c.test(a)){i=a;j=e(b);k&&f(d,i,j)}return this},destroy:function(){b||b&&a.core.evt.removeEvent(window,"scroll",n);a.core.evt.removeEvent(window,"resize",n);a.core.evt.custEvent.undefine(l)}};l=a.core.evt.custEvent.define(m,"beforeFix");m.setAlign(g,h);function n(c){c=c||window.event;a.core.evt.custEvent.fire(l,"beforeFix",c.type);k&&(!b||i=="c")&&f(d,i,j)}b||a.core.evt.addEvent(window,"scroll",n);a.core.evt.addEvent(window,"resize",n);return m}}});
STK.register("module.mask",function(a){function k(b){var c;(c=b.getAttribute(f))||b.setAttribute(f,c=a.getUniqueKey());return">"+b.tagName.toLowerCase()+"["+f+'="'+c+'"]'}function j(){b=a.C("div");var c='<div node-type="outer">';a.core.util.browser.IE6&&(c+='<div style="position:absolute;width:100%;height:100%;"></div>');c+="</div>";b=a.builder(c).list.outer[0];document.body.appendChild(b);e=!0;d=a.kit.dom.fix(b,"lt");var f=function(){var c=a.core.util.winSize();b.style.cssText=a.kit.dom.cssText(b.style.cssText).push("width",c.width+"px").push("z-index","99995").push("height",c.height+"px").getCss()};i.add(d,"beforeFix",f);f()}var b,c=[],d,e=!1,f="STK-Mask-Key",g=a.core.dom.setStyle,h=a.core.dom.getStyle,i=a.core.evt.custEvent,l={getNode:function(){return b},show:function(c,f){if(e){c=a.core.obj.parseParam({opacity:.3,background:"#000000"},c);b.style.background=c.background;g(b,"opacity",c.opacity);b.style.display="";d.setAlign("lt");f&&f()}else a.Ready(function(){j();l.show(c,f)});return l},hide:function(){b.style.display="none";nowIndex=undefined;c=[];return l},showUnderNode:function(d,e){a.isNode(d)&&l.show(e,function(){g(b,"zIndex",h(d,"zIndex"));var e=k(d),f=a.core.arr.indexOf(c,e);f!=-1&&c.splice(f,1);c.push(e);a.core.dom.insertElement(d,b,"beforebegin")});return l},back:function(){if(c.length<1)return l;var d,e;c.pop();if(c.length<1)l.hide();else if((e=c[c.length-1])&&(d=a.sizzle(e,document.body)[0])){g(b,"zIndex",h(d,"zIndex"));a.core.dom.insertElement(d,b,"beforebegin")}else l.back();return l},destroy:function(){i.remove(d);b.style.display="none";lastNode=undefined;_cache={}}};return l});
STK.register("kit.dom.drag",function(a){return function(b,c){var d,e,f,g,h,i,j,k,l=function(){m();n()},m=function(){d=a.parseParam({moveDom:b,perchStyle:"border:solid #999999 2px;",dragtype:"perch",actObj:{},pagePadding:5},c);f=d.moveDom;e={};g={};h=a.drag(b,{actObj:d.actObj});if(d.dragtype==="perch"){i=a.C("div");j=!1;k=!1;f=i}b.style.cursor="move"},n=function(){a.custEvent.add(d.actObj,"dragStart",o);a.custEvent.add(d.actObj,"dragEnd",p);a.custEvent.add(d.actObj,"draging",q)},o=function(c,e){document.body.style.cursor="move";var f=a.core.util.pageSize().page;g=a.core.dom.position(d.moveDom);g.pageX=e.pageX;g.pageY=e.pageY;g.height=d.moveDom.offsetHeight;g.width=d.moveDom.offsetWidth;g.pageHeight=f.height;g.pageWidth=f.width;if(d.dragtype==="perch"){var h=[];h.push(d.perchStyle);h.push("position:absolute");h.push("z-index:"+(d.moveDom.style.zIndex+10));h.push("width:"+d.moveDom.offsetWidth+"px");h.push("height:"+d.moveDom.offsetHeight+"px");h.push("left:"+g.l+"px");h.push("top:"+g.t+"px");i.style.cssText=h.join(";");k=!0;setTimeout(function(){if(k){document.body.appendChild(i);j=!0}},100)}b.setCapture!==undefined&&b.setCapture()},p=function(a,c){document.body.style.cursor="auto";b.setCapture!==undefined&&b.releaseCapture();if(d.dragtype==="perch"){k=!1;d.moveDom.style.top=i.style.top;d.moveDom.style.left=i.style.left;if(j){document.body.removeChild(i);j=!1}}},q=function(a,b){var c=g.t+(b.pageY-g.pageY),e=g.l+(b.pageX-g.pageX),h=c+g.height,i=e+g.width,j=g.pageHeight-d.pagePadding,k=g.pageWidth-d.pagePadding;if(h<j&&c>0)f.style.top=c+"px";else{c<0&&(f.style.top="0px");h>=j&&(f.style.top=j-g.height+"px")}if(i<k&&e>0)f.style.left=e+"px";else{e<0&&(f.style.left="0px");i>=k&&(f.style.left=k-g.width+"px")}};l();e.destroy=function(){document.body.style.cursor="auto";typeof f.setCapture=="function"&&f.releaseCapture();if(d.dragtype==="perch"){k=!1;if(j){document.body.removeChild(i);j=!1}}a.custEvent.remove(d.actObj,"dragStart",o);a.custEvent.remove(d.actObj,"dragEnd",p);a.custEvent.remove(d.actObj,"draging",q);h.destroy&&h.destroy();d=null;f=null;g=null;h=null;i=null;j=null;k=null};e.getActObj=function(){return d.actObj};return e}});
STK.register("ui.dialog",function(a){var b='<div class="W_layer" node-type="outer" style="display:none;position:absolute;z-index:10001"><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="content"><div class="title" node-type="title"><span node-type="title_content"></span></div><a href="javascript:void(0);" class="W_close" title="#L{关闭}" node-type="close"></a><div node-type="inner"></div></div></td></tr></table></div></div>',c=a.kit.extra.language,d=null,e=function(){var d=a.module.dialog(c(b));a.custEvent.add(d,"show",function(){a.module.mask.showUnderNode(d.getOuter())});a.custEvent.add(d,"hide",function(){a.module.mask.back();d.setMiddle()});a.kit.dom.drag(d.getDom("title"),{actObj:d,moveDom:d.getOuter()});d.destroy=function(){f(d);try{d.hide(!0)}catch(a){}};return d},f=function(a){a.setTitle("").clearContent();d.setUnused(a)};return function(b){var c=a.parseParam({isHold:!1},b),g=c.isHold;c=a.core.obj.cut(c,["isHold"]);d||(d=a.kit.extra.reuse(e));var h=d.getOne();g||a.custEvent.add(h,"hide",function(){a.custEvent.remove(h,"hide",arguments.callee);f(h)});return h}});
STK.register("ui.alert",function(a){var b='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="W_texta" node-type="textLarge"></p><p class="W_textb" node-type="textSmall"></p></dd></dl><div class="btn"><a href="javascript:void(0)" class="W_btn_b" node-type="OK"></a></div></div>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.kit.extra.language,e=null,f=function(a,b){a.getDom("icon").className=b.icon;a.getDom("textLarge").innerHTML=b.textLarge;a.getDom("textSmall").innerHTML=b.textSmall;a.getDom("OK").innerHTML="<span>"+b.OKText+"</span>"};return function(g,h){var i,j,k,l,m;i=a.parseParam({title:d("#L{提示}"),icon:"warn",textLarge:g,textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),timeout:0},h);i.icon=c[i.icon];j={};e||(e=a.kit.extra.reuse(function(){var c=a.module.layer(d(b));return c}));k=e.getOne();l=a.ui.dialog();l.setContent(k.getOuter());l.setTitle(i.title);f(k,i);a.addEvent(k.getDom("OK"),"click",l.hide);a.custEvent.add(l,"hide",function(){a.custEvent.remove(l,"hide",arguments.callee);a.removeEvent(k.getDom("OK"),"click",l.hide);e.setUnused(k);clearTimeout(m);i.OK()});i.timeout&&(m=setTimeout(l.hide,i.timeout));l.show().setMiddle();j.alt=k;j.dia=l;return j}});
STK.register("kit.extra.crc32",function(a){return function(a,b){function c(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128)b+=String.fromCharCode(d);else if(d>127&&d<2048){b+=String.fromCharCode(d>>6|192);b+=String.fromCharCode(d&63|128)}else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128);b+=String.fromCharCode(d&63|128)}}return b}a=c(a);var d="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D",b;typeof b=="undefined"&&(b=0);var e=0,f=0;b=b^-1;for(var g=0,h=a.length;g<h;g++){f=(b^a.charCodeAt(g))&255;e="0x"+d.substr(f*9,8);b=b>>>8^e}var i=b^-1;i<0&&(i=4294967296+i);return i}});
STK.register("common.extra.imageURL",function(a){return function(b,c){function f(a){a=(a+"").replace(/[^a-f0-9]/gi,"");return parseInt(a,16)}var d={size:"small"};if(typeof b=="string"){d=a.core.obj.parseParam(d,c);var e=d.size,g={ss:{middle:"&690",bmiddle:"&690",small:"&690",thumbnail:"&690",square:"&690",orignal:"&690"},ww:{middle:"bmiddle",large:"large",bmiddle:"bmiddle",small:"small",thumbnail:"thumbnail",square:"square",orignal:"large"}},h=b.charAt(9)=="w",i=b.charAt(21)=="g"?".gif":".jpg",j=h?a.kit.extra.crc32(b)%4+1:f(b.substr(19,2))%16+1,k="http://"+(h?"ww":"ss")+j+".sinaimg.cn/"+(h?g.ww[e]:e)+"/"+b+(h?i:"")+(h?"":g.ss[e]);return k}}});
STK.register("kit.extra.swfobject",function(a){var b=function(){function W(b){var c=/[\\\"<>\.;]/,d=c.exec(b)!=null;return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}function V(a,b){if(!!y){var c=b?"visible":"hidden";u&&Q(a)?Q(a).style.visibility=c:U("#"+a,"visibility:"+c)}}function U(b,d,e,f){if(!z.ie||!z.mac){var g=j.getElementsByTagName("head")[0];if(!g)return;var h=e&&typeof e=="string"?e:"screen";if(f){w=null;x=null}if(!w||x!=h){var i=R("style");i.setAttribute("type","text/css");i.setAttribute("media",h);w=g.appendChild(i);z.ie&&z.win&&typeof j.styleSheets!=a&&j.styleSheets.length>0&&(w=j.styleSheets[j.styleSheets.length-1]);x=h}z.ie&&z.win?w&&typeof w.addRule==c&&w.addRule(b,d):w&&typeof j.createTextNode!=a&&w.appendChild(j.createTextNode(b+" {"+d+"}"))}}function T(a){var b=z.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function S(a,b,c){a.attachEvent(b,c);p[p.length]=[a,b,c]}function R(a){return j.createElement(a)}function Q(a){var b=null;try{b=j.getElementById(a)}catch(c){}return b}function P(a){var b=Q(a);if(b){for(var c in b)typeof b[c]=="function"&&(b[c]=null);b.parentNode.removeChild(b)}}function O(a){var b=Q(a);if(b&&b.nodeName=="OBJECT")if(z.ie&&z.win){b.style.display="none";(function(){b.readyState==4?P(a):setTimeout(arguments.callee,10)})()}else b.parentNode.removeChild(b)}function N(a,b,c){var d=R("param");d.setAttribute("name",b);d.setAttribute("value",c);a.appendChild(d)}function M(b,d,e){var g,h=Q(e);if(z.wk&&z.wk<312)return g;if(h){typeof b.id==a&&(b.id=e);if(z.ie&&z.win){var i="";for(var j in b)b[j]!=Object.prototype[j]&&(j.toLowerCase()=="data"?d.movie=b[j]:j.toLowerCase()=="styleclass"?i+=' class="'+b[j]+'"':j.toLowerCase()!="classid"&&(i+=" "+j+'="'+b[j]+'"'));var k="";for(var l in d)d[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+d[l]+'" />');h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>";o[o.length]=b.id;g=Q(b.id)}else{var m=R(c);m.setAttribute("type",f);for(var n in b)b[n]!=Object.prototype[n]&&(n.toLowerCase()=="styleclass"?m.setAttribute("class",b[n]):n.toLowerCase()!="classid"&&m.setAttribute(n,b[n]));for(var p in d)d[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"&&N(m,p,d[p]);h.parentNode.replaceChild(m,h);g=m}}return g}function L(a){var b=R("div");if(z.win&&z.ie)b.innerHTML=a.innerHTML;else{var d=a.getElementsByTagName(c)[0];if(d){var e=d.childNodes;if(e){var f=e.length;for(var g=0;g<f;g++)(e[g].nodeType!=1||e[g].nodeName!="PARAM")&&e[g].nodeType!=8&&b.appendChild(e[g].cloneNode(!0))}}}return b}function K(a){if(z.ie&&z.win&&a.readyState!=4){var b=R("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(L(a),b);a.style.display="none";(function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(L(a),a)}function J(b,c,d,e){v=!0;s=e||null;t={success:!1,id:d};var f=Q(d);if(f){if(f.nodeName=="OBJECT"){q=L(f);r=null}else{q=f;r=d}b.id=g;if(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310)b.width="310";if(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137)b.height="137";j.title=j.title.slice(0,47)+" - Flash Player Installation";var h=z.ie&&z.win?"ActiveX":"PlugIn",k="MMredirectURL="+i.location.toString().replace(/&/g,"%26")+"&MMplayerType="+h+"&MMdoctitle="+j.title;typeof c.flashvars!=a?c.flashvars+="&"+k:c.flashvars=k;if(z.ie&&z.win&&f.readyState!=4){var l=R("div");d+="SWFObjectNew";l.setAttribute("id",d);f.parentNode.insertBefore(l,f);f.style.display="none";(function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)})()}M(b,c,d)}}function I(){return!v&&T("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function H(b){var d=null,e=Q(b);if(e&&e.nodeName=="OBJECT")if(typeof e.SetVariable!=a)d=e;else{var f=e.getElementsByTagName(c)[0];f&&(d=f)}return d}function G(){var b=n.length;if(b>0)for(var c=0;c<b;c++){var d=n[c].id,e=n[c].callbackFn,f={success:!1,id:d};if(z.pv[0]>0){var g=Q(d);if(g)if(T(n[c].swfVersion)&&!(z.wk&&z.wk<312)){V(d,!0);if(e){f.success=!0;f.ref=H(d);e(f)}}else if(n[c].expressInstall&&I()){var h={};h.data=n[c].expressInstall;h.width=g.getAttribute("width")||"0";h.height=g.getAttribute("height")||"0";g.getAttribute("class")&&(h.styleclass=g.getAttribute("class"));g.getAttribute("align")&&(h.align=g.getAttribute("align"));var i={},j=g.getElementsByTagName("param"),k=j.length;for(var l=0;l<k;l++)j[l].getAttribute("name").toLowerCase()!="movie"&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));J(h,i,d,e)}else{K(g);e&&e(f)}}else{V(d,!0);if(e){var m=H(d);if(m&&typeof m.SetVariable!=a){f.success=!0;f.ref=m}e(f)}}}}function F(){var b=j.getElementsByTagName("body")[0],d=R(c);d.setAttribute("type",f);var e=b.appendChild(d);if(e){var g=0;(function(){if(typeof e.GetVariable!=a){var c=e.GetVariable("$version");if(c){c=c.split(" ")[1].split(",");z.pv=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}}else if(g<10){g++;setTimeout(arguments.callee,10);return}b.removeChild(d);e=null;G()})()}else G()}function E(){l?F():G()}function D(b){if(typeof i.addEventListener!=a)i.addEventListener("load",b,!1);else if(typeof j.addEventListener!=a)j.addEventListener("load",b,!1);else if(typeof i.attachEvent!=a)S(i,"onload",b);else if(typeof i.onload=="function"){var c=i.onload;i.onload=function(){c();b()}}else i.onload=b}function C(a){u?a():m[m.length]=a}function B(){if(!u){try{var a=j.getElementsByTagName("body")[0].appendChild(R("span"));a.parentNode.removeChild(a)}catch(b){return}u=!0;var c=m.length;for(var d=0;d<c;d++)m[d]()}}var a="undefined",c="object",d="Shockwave Flash",e="ShockwaveFlash.ShockwaveFlash",f="application/x-shockwave-flash",g="SWFObjectExprInst",h="onreadystatechange",i=window,j=document,k=navigator,l=!1,m=[E],n=[],o=[],p=[],q,r,s,t,u=!1,v=!1,w,x,y=!0,z=function(){var b=typeof j.getElementById!=a&&typeof j.getElementsByTagName!=a&&typeof j.createElement!=a,g=k.userAgent.toLowerCase(),h=k.platform.toLowerCase(),m=h?/win/.test(h):/win/.test(g),n=h?/mac/.test(h):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof k.plugins!=a&&typeof k.plugins[d]==c){r=k.plugins[d].description;if(r&&(typeof k.mimeTypes==a||!k.mimeTypes[f]||!!k.mimeTypes[f].enabledPlugin)){l=!0;p=!1;r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1");q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10);q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10);q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof i.ActiveXObject!=a)try{var s=new ActiveXObject(e);if(s){r=s.GetVariable("$version");if(r){p=!0;r=r.split(" ")[1].split(",");q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}}}catch(t){}return{w3:b,pv:q,wk:o,ie:p,win:m,mac:n}}(),A=function(){if(!!z.w3){(typeof j.readyState!=a&&j.readyState=="complete"||typeof j.readyState==a&&(j.getElementsByTagName("body")[0]||j.body))&&B();if(!u){typeof j.addEventListener!=a&&j.addEventListener("DOMContentLoaded",B,!1);if(z.ie&&z.win){j.attachEvent(h,function(){if(j.readyState=="complete"){j.detachEvent(h,arguments.callee);B()}});i==top&&function(){if(!u){try{j.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}B()}}()}z.wk&&function(){if(!u){if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}B()}}();D(B)}}}(),X=function(){z.ie&&z.win&&window.attachEvent("onunload",function(){var a=p.length;for(var c=0;c<a;c++)p[c][0].detachEvent(p[c][1],p[c][2]);var d=o.length;for(var e=0;e<d;e++)O(o[e]);for(var f in z)z[f]=null;z=null;for(var g in b)b[g]=null;b=null})}();return{registerObject:function(a,b,c,d){if(z.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;n[n.length]=e;V(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(z.w3)return H(a)},embedSWF:function(b,d,e,f,g,h,i,j,k,l){var m={success:!1,id:d};if(z.w3&&!(z.wk&&z.wk<312)&&b&&d&&e&&f&&g){V(d,!1);C(function(){e+="";f+="";var n={};if(k&&typeof k===c)for(var o in k)n[o]=k[o];n.data=b;n.width=e;n.height=f;var p={};if(j&&typeof j===c)for(var q in j)p[q]=j[q];if(i&&typeof i===c)for(var r in i)typeof p.flashvars!=a?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(T(g)){var s=M(n,p,d);n.id==d&&V(d,!0);m.success=!0;m.ref=s}else{if(h&&I()){n.data=h;J(n,p,d,l);return}V(d,!0)}l&&l(m)})}else l&&l(m)},switchOffAutoHideShow:function(){y=!1},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:T,createSWF:function(a,b,c){return z.w3?M(a,b,c):undefined},showExpressInstall:function(a,b,c,d){z.w3&&I()&&J(a,b,c,d)},removeSWF:function(a){z.w3&&O(a)},createCSS:function(a,b,c,d){z.w3&&U(a,b,c,d)},addDomLoadEvent:C,addLoadEvent:D,getQueryParamValue:function(a){var b=j.location.search||j.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(a==null)return W(b);var c=b.split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return W(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(v){var a=Q(g);if(a&&q){a.parentNode.replaceChild(q,a);if(r){V(r,!0);z.ie&&z.win&&(q.style.display="block")}s&&s(t)}v=!1}}}}();return b});
STK.register("common.flash.imgUpload",function(a){var b=document.documentElement,c=document.body,d={getScroll:function(){var a,d,e,f;if(b&&b.scrollTop){a=b.scrollTop;d=b.scrollLeft;e=b.scrollWidth;f=b.scrollHeight}else if(c){a=c.scrollTop;d=c.scrollLeft;e=c.scrollWidth;f=c.scrollHeight}return{t:a,l:d,w:e,h:f}},getScreen:function(){var c={};if(a.IE){c.w=b.clientWidth;c.h=b.clientHeight}else{c.w=window.innerWidth;c.h=window.innerHeight}return c}},e=function(a){var b={cn:"zh_CN",tw:"zh_TW"};a=a.toLowerCase();a=a.replace(/zh-/g,"");return b[a]};return function(b,f){var g={version:$CONFIG.version,swf_path:$CONFIG.jsPath+"home/static/swf/img/",service:b.service,ed_swf:b.swf||"PhotoEditor.swf",exp_swf:"expressInstall.swf",h:b.h||385,w:b.w||528,f_version:"10.0.0",channel:b.id+"_channel",id_panel:b.id+"_panel",id_swf:b.id+"_swf"},h={},i,j,k={init:function(){f.init&&f.init(h,b)},setHeight:function(b){a.IE||(m.getFlash(g.id_swf).height=b)},upComplate:function(a){b.sucess&&b.sucess(a);i.style.display="none";h.destory()},closeEditor:function(){i.style.display="none";h.destory();f.close&&f.close(h,b)},suda:function(a){SUDA&&SUDA.uaTrack&&SUDA.uaTrack("meitu","v4||"+a)}},l={version:g.version,language:e($CONFIG.lang),channel:g.channel,JSHandler:"STK.core.util.listener.fire",initFun:"init",changeFlashHeightFun:"setHeight",uploadCompleteFun:"upComplate",closePhotoEditorFun:"closeEditor",suda:"suda"},m={init:function(){if(!!b.id){i=a.E(g.id_panel);j=a.E(g.id_swf);if(!i){i=a.C("div");i.id=g.id_panel;c.appendChild(i)}if(!j){j=a.C("div");j.id=g.id_swf;i.appendChild(j)}i.style.display="none";m.getFlash(g.id_swf)||m.build()}},checkAction:function(a,b){var c=STK.core.util.listener.list;return!!c[a]&&!!c[a][b]},bindEvt:function(a){for(key in a)k[a[key]]&&!m.checkAction(g.channel,a[key])&&STK.core.util.listener.register(g.channel,a[key],k[a[key]])},build:function(){var c={menu:"true",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:a.IE?"window":"transparent",base:g.swf_path},d={id:b.id};m.bindEvt(l);a.kit.extra.swfobject.embedSWF(g.swf_path+g.ed_swf+"?version="+g.version,g.id_swf,g.w,g.h,g.f_version,g.swf_path+g.exp_swf,l,c,d)},getFlash:function(){return navigator.appName.indexOf("Microsoft")!=-1?window[b.id]:document[b.id]},setPos:function(){var c,e,f,h,j=d.getScroll(),k=d.getScreen();f=Math.round(g.h>k.h?k.h/5+j.t:(k.h-g.h)/2+j.t);h=Math.round(g.w>k.w?k.w/5+j.l:(k.w-g.w)/2+j.l);c=b.pos.t-1||f;e=b.pos.l||h;i.style.zIndex=b.zIndex||2e4;a.setStyle(i,"position","absolute");a.setStyle(i,"left",e+"px");a.setStyle(i,"top",c+"px");m.autoScroll(j.t,j.t+(c-f))},autoScroll:function(a,b,c){var d,e,f,g=8,h;g=c||g;h=a-b;e=[h];e[g]=0;f=1;for(f;f<g;f++)e[f]=h=h/2;clearInterval(d);d=setInterval(function(){e.length?window.scrollTo(0,b+e.shift()):clearInterval(d)},30)}};h.show=function(a){a&&(b.id=a);i&&(i.style.display="");m.setPos();return this};h.hide=function(){i&&(i.style.display="");return this};h.setPars=function(a){var b={imageURL:a||"",uploadURL:g.service};m.getFlash(g.id_swf).editPhoto(b);return this};h.getSwf=m.getFlash;h.destory=function(){if(a.IE){for(key in l)k[l[key]]&&STK.core.util.listener.remove(g.channel,l[key],k[l[key]]);i.innerHTML=""}};m.init();return h}});
STK.register("common.bubble.image",function($){var cfg=window.$CONFIG,actionURL=/service/.test(document.location.host)?"/widget/public/aj_uploadpic.php":"/public/aj_uploadpic.php",TEMPOUTER='<!-- 发布器图片弹层 --><div class="WB_widgets WB_tips_show" node-type="outer" style="position:absolute;"> <span class="ts_arr"></span><div class="Wb_tipsshow_wrap"> <a href="#" onclick="return false;" action-type="close" node-type="close" class="WB_tips_show_close" title="关闭">关闭</a> <!-- 内容区 --><div class="tipsshow_detail layer_pic" node-type="inner"><div node-type="upload_form" class="detail_choose"><form node-type="form" action="'+actionURL+'" method="post" target="upload_iframe" enctype="multipart/form-data">'+'<p class="pic_btn clearfix">'+'<a href="#" onclick="return false;" class="WB_btnA"><span>上传图片</span></a>'+'<input type="file" hidefoucs="true" node-type="fileBtn" contenteditable="false" name="pic" id="activity_img" class="file_input">'+'<input type="hidden" name="appkey" value="'+($CONFIG.appkey||"")+'"/  style="display:none;">'+'<input type="hidden" name="wsrc" value="'+($CONFIG.wsrc||"app_topic_base")+'" style="display:none;" />'+"</p>"+"</form>"+'<p class="extip">请选择小于5M的gif、jpg、png图片</p>'+"</div>"+'<div node-type="upload_status"></div>'+"</div>"+'<iframe src="" node-type="upload_iframe" id="upload_iframe" name="upload_iframe" style="display:none;"></iframe>'+"<!-- /内容区 --> "+"</div>"+"</div>"+"<!-- /发布器图片弹层 -->",LOADING='<div class="detail_loading"><p class="extip"><em class="icon_loading WB_loadingbgS"></em>图片正在上传，请稍后</p><p class="pic_btn clearfix"><a href="#" onclick="return false;" action-type="cancel" class="WB_btnA"><span>取消上传</span></a></p></div>',FAIL='<div class="detail_faila"><p class="extip"><i class="content_velm"></i><span class="maintip"><em class="WB_icon WB_tipS_warn"></em><em class="WB_icon_txt">图片上传失败</em><em class="subtip">##REASON##</em></span></p><p class="pic_btn clearfix"><a href="#" onclick="return false;" action-type="retry" class="WB_btnA"><span>重新上传</span></a></p></div>',SHOW_IMG='<div class="pic_show_layer"><p class="pic_name">##PIC_NAME##</p><div class="pic_show"><img src="##PIC_URL##" alt="" /></div><p class="pic_action"><a href="#" onclick="return false;" action-type="delete" class="pic_del" href="">删除</a></p></div>',DEFAULT_WORD="#L{分享图片}",IMGMASK="weibo.com/",bub,outer,inner,content,cancel,cacheTab,wmark,uppid,imgName,cacheData,dEvent,uniqueKey,that={},nodes,location,position=$.core.dom.position,addEvent=$.core.evt.addEvent,rmEvent=$.core.evt.removeEvent,L=$.kit.extra.language,bind=function(){$.custEvent.define(that,"uploaded");$.custEvent.define(that,"hide");$.custEvent.define(that,"insert");$.custEvent.define(that,"deletePIC");$.custEvent.define(that,"picLoad");dEvent=$.core.evt.delegatedEvent(outer);upLoad.bind()},upLoad={initDom:function(){var a;cacheTab=upLoad;nodes.close=bub.getDomList().close[0];a=$.kit.dom.parseDOM($.core.dom.builder(outer).list);nodes=$.kit.extra.merge(nodes,a)},bind:function(){addEvent(nodes.fileBtn,"change",bindDOMFuncs.upload);dEvent.add("delete","click",upLoad.deletePic);dEvent.add("cancel","click",upLoad.cancelUpload);dEvent.add("retry","click",upLoad.retry);dEvent.add("close","click",upLoad.close)},destroy:function(){rmEvent(nodes.inputCover,"mousemove",upLoad.ajust);rmEvent(nodes.fileBtn,"change",bindDOMFuncs.upload)},handle:function(){if(uniqueKey!=null){var ret;try{ret=nodes.upload_iframe.contentWindow.document.body.innerHTML}catch(e){}if(ret==null||ret.indexOf("{")!=0){nodes.inner.innerHTML=FAIL;return}ret=eval("("+ret+")");ret.code=parseInt(ret.code);if(!ret||ret.code>1e5){var msg="";switch(ret.code){case 100001:msg="#L{系统繁忙}";break;case 100002:msg="#L{没有登录}";break;default:msg=ret.msg}nodes.upload_status.innerHTML=FAIL.replace(/##REASON##/g,msg)}else{upLoad.stopUpload();if(cancel){nodes.inner.innerHTML=WAIT;nodes.close.style.display="";cancel=!1}else upLoad.rendSucc({pid:ret.data})}}},rendLoad:function(){nodes.close.style.display="none";nodes.form.submit();upLoad.formStaus(!1);nodes.upload_status.innerHTML=LOADING},rendSucc:function(a){var b=$.common.extra.imageURL(a.pid),c=[],d,e;imgName=imgName||a.pid;c=imgName.split(/\/|\\/);d=c[c.length-1];c=d.split(".");if(c.length>1&&$.bLength(c[0])>20){c[0]=$.leftB(c[0],20);e=[c[0],"...",c[1]].join("")}else e=d;uppid=a.pid;bindDOMFuncs.loadPic({url:b,value:e,pid:a.pid,name:a.name})},deletePic:function(){upLoad.formStaus(!0);nodes.close.style.display="";$.custEvent.fire(that,"deletePIC",{text:L(DEFAULT_WORD)})},stopUpload:function(){upLoad.formStaus(!0);nodes.close.style.display=""},cancelUpload:function(){cancel=!0;$.removeEvent(nodes.upload_iframe,"load",upLoad.handle);upLoad.formStaus(!0);upLoad.stopUpload()},formStaus:function(a){a==null&&(a=!1);$.setStyle(nodes.upload_form,"display",a?"":"none");$.setStyle(nodes.upload_status,"display",a?"none":"")},retry:function(){upLoad.formStaus(!0);nodes.form.reset();nodes.close.style.display=""},close:function(){$.custEvent.fire(that,"hide");$.custEvent.fire(that,"deletePIC",{text:L(DEFAULT_WORD)})}},bindDOMFuncs={upload:function(){uniqueKey=(new Date).getTime();imgName=nodes.fileBtn.value;if($.core.str.trim(imgName)!==""){$.addEvent(nodes.upload_iframe,"load",upLoad.handle);upLoad.rendLoad()}},loadPic:function(a){upLoad.formStaus(!1);nodes.upload_status.innerHTML=SHOW_IMG.replace(/##([^#]+)##/g,function(b,c){switch(c){case"PIC_NAME":return a.value;case"PIC_URL":return a.url}});nodes.close.style.display="none";$.core.evt.custEvent.fire(that,"uploaded",{text:L(DEFAULT_WORD),pid:a.pid})}},bindCustEvtFuncs={};that.reset=function(){uniqueKey=null;upLoad.retry()};that.getBub=function(){return bub};return function(a,b){if(!$.isNode(a))throw"common.bubble.image need el as first parameter!";location=window.location.href;if(bub==null){bub=$.module.layer(L(TEMPOUTER));nodes=$.kit.dom.parseDOM(bub.getDomList());outer=nodes.outer;upLoad.initDom();if(b&&b.pid){var c=$.common.extra.imageURL(b.pid);bindDOMFuncs.loadPic({url:c,pid:b.pid})}bind();$.kit.dom.layoutPos(bub.getOuter(),a,{offsetX:-9,offsetY:3})}that.bubble=bub;bub.show();return that}});
STK.register("common.topic.delegate",function(a){function m(){if(d!=!0){d=!0;var b=a.common.trans.topic.getTrans("person_info",{onComplete:function(b){var c,e;switch(b.code){case"100000":b.data&&b.data.name&&(a.bLength(b.data.name)>16?b.data.short_name=a.leftB(b.data.name,14)+"…":b.data.short_name=b.data.name);b.data.icon?e=j:b.data.name?e=l:e=k;e=a.core.util.easyTemplate(e,b.data)}var f=a.sizzle('div[class="topic_infomain WB_loginButton"]',n);f.length>0&&(f[0].innerHTML=e);d=null},onFail:function(){d=null}});b.request({wsrc:$CONFIG.wsrc||"app_topic_base"})}}var b,c,d,e=location.host,f=a.kit.extra.language,g=/service/.test(e)?"http://service.weibo.com/reg/loginindex.php?appsrc=1lzBEX&backurl=http%3A%2F%2F"+e+"%2Fwidget%2Fpublic%2FloginProxy.html&vsrc=app_topic&showlogo=0":"http://service.weibo.com/reg/loginindex.php?appsrc=1lzBEX&backurl=http%3A%2F%2F"+e+"%2Fpublic%2FloginProxy.html&vsrc=app_cmtbox&showlogo=0",h=/service/.test(e)?"http://weibo.com/signup/signup.php?vsrc=app_widget_topic_width&backurl=http%3A%2F%2F"+e+"%2Fwidget%2Fpublic%2FloginProxy.html&from=zw&showlogo=0&appsrc=1lzBEX":"http://weibo.com/signup/signup.php?vsrc=app_widget_topic_width&backurl=http%3A%2F%2F"+e+"%2Fpublic%2FloginProxy.html&showlogo=0&appsrc=1lzBEX",i="http://weibo.com/signup/full_info.php?appsrc=1lzBEX&backurl=http%3A%2F%2Fweibo.com&showlogo=0&vsrc=app_sharepop&diy=&from=zw&regbackurl=http%3A%2F%2F&c=&refer=http%3A%2F%2F",j=f('<#et userlist data><div class="user_info clearfix"><div class="info_pic"><a href="http://weibo.com/u/${data.uid}" target="_blank"><img alt="${data.name}" src="${data.icon}"></a></div><div class="info_detail"><p class="detail_name"><a title="${data.name}" href="http://weibo.com/u/${data.uid}" target="_blank">${data.short_name}</a><#if (data.user_type == 0)><span class="WB_approve feed_icon"></span><#elseif (data.user_type == 1)><span class="WB_approve_co feed_icon"></span><#elseif (data.user_type == 2)><span class="WB_ico_club feed_icon"></span></#if></p><p class="info_add">${data.province},${data.city}</p></div></div><ul class="user_atten clearfix"><li><a href="http://weibo.com/${data.uid}/follow" target="_blank"><strong>${data.attmenum}</strong></a><span>#L{关注}</span></li><li><a href="http://weibo.com/${data.uid}/fans" target="_blank"><strong>${data.meattnum}</strong></a><span>#L{粉丝}</span></li><li class="last"><a href="http://weibo.com/${data.uid}/profile" target="_blank"><strong node-type="weibo_count">${data.mblognum}</strong></a><span>#L{微博}</span></li></ul>'),k=f('<div class="info_login"><p>#L{已经有新浪账号，请}<a href="'+g+'" onclick="return false;" action-type="login">#L{登录}</a></p>'+"<p>#L{还没有微博账号？}</p>"+'<a class="WB_btngB" href="'+h+'" onclick="return false;" action-type="regist"><span>#L{立即注册}</span></a>'+"</div>"),l=f('<#et userlist data><div class="info_login"><p class="login_mail"><a href="http://weibo.com/u/${data.uid}" target="_blank">${data.name}</a></p><p class="login_tip"><span class="WB_tipS_warn small_state_icon"></span><span class="small_state_info">#L{您的帐号尚未开通微博}</span></p><a class="WB_btngB" href="'+i+'" onclick="return false;" action-type="fullinfo"><span>#L{立即开通}</span></a>'+"</div>"),n;return{init:function(d,e){if(d!=null){e&&e.pl&&(n=e.pl);var f=a.sizzle('li[class="current"]',d);if(f.length>0){b=f[0];c=b.getAttribute("action-data").replace("key=","")}return c}},changeTab:function(d){if(d.data.key!=c){b&&(b.className="");d.el.className="current";b=d.el;c=b.getAttribute("action-data").replace("key=","");a.common.channel.feed.fire("reload",c)}},login:function(a,b){window.App=window.App||{};App.loginBackUrlCallBack=function(){if(b){b();m();!/service/.test(e)&&location.reload()}else location.reload();try{var a=scope.loginKit().uid,c=$CONFIG.refer||"";(new Image).src="http://rs.sinajs.cn/r.gif?uid="+a+"&appid="+$CONFIG.appkey+"&refer="+c+"&cat=2&rnd="+ +(new Date)}catch(d){}};var c=g;window.open(c,"login","width=750,height=620")},logout:function(){},regist:function(a,b){window.App=window.App||{};App.loginBackUrlCallBack=function(){if(b){b();m()}else location.reload()};var c=h;window.open(c,"regist","width=750,height=620")},fullinfo:function(){if(typeof $CONFIG!="undefined"&&typeof $CONFIG.is_sina_user!="undefined"&&$CONFIG.is_sina_user=="1"){var a=i;window.open(a,"fullinfo","width=950,height=620");return!0}return!1}}});
STK.register("common.editor.widget.image",function(a){return function(b){var c={},d,e,f,g,h,i=function(a,b){d.API.insertText(b.value);e.getBub().hide()},j=function(a,b){var c=d.API.getWords();c.length==0&&d.API.insertText(b.text);d.API.addExtraInfo(b.pid);g=!1},k=function(a,b){d.API.delWords(b.text);d.API.addExtraInfo("");clearInterval(h);e.reset()},l=function(b){a.core.evt.stopEvent();if(!a.common.topic.delegate.fullinfo()){if(scope.loginKit().isLogin==!1){a.common.topic.delegate.login(null,l);return}if(g)return;try{a.core.evt.preventDefault()}catch(m){}if(typeof b=="string"){e=a.common.bubble.image(d.nodeList[f],{pid:b});h=setInterval(function(){e.bubble.setLayout(d.nodeList[f],{offsetX:-29,offsetY:5})},200)}else e=a.common.bubble.image(d.nodeList[f]);b=d.API.getExtra();b||e.reset();a.custEvent.add(e,"uploaded",j);a.custEvent.add(e,"insert",i);a.custEvent.add(e,"deletePIC",k);a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);a.custEvent.remove(e,"uploaded",j);a.custEvent.remove(e,"insert",i);a.custEvent.remove(e,"deletePIC",k);a.custEvent.remove(e,"changeType");c.hide();g=!1});a.core.evt.custEvent.fire(c.custKeyShow,"show",["image"])}};c.init=function(b,c,e){d=b;f=c;a.addEvent(b.nodeList[f],"click",l);e&&e.pid&&l(e.pid)};c.clear=function(){};c.show=function(){e.getBub().show()};c.hide=function(){e&&e.getBub().hide();g=!1};c.resetBubble=function(a){e&&e.bubble.setLayout(a,{offsetX:-29,offsetY:5})};c.destroy=function(){d=null};c.custKeyShow=a.core.evt.custEvent.define(c,"show");return c}});
STK.register("common.editor.widget.topic",function(a){return function(){var b={},c=a.kit.extra.language,d,e,f={text:c("##L{在这里输入你想要说的话题}#")},g=function(b){var c=b,e=d.nodeList.textEl,f=e.value,g=c.length-2;if(f.indexOf(c)!=-1){var h=f.indexOf(c);a.kit.extra.textareaUtils.setCursor(e,h+1,g)}else{d.API.insertText(c);var i=a.kit.extra.textareaUtils.getCursorPos(e);a.kit.extra.textareaUtils.setCursor(e,i-(g+1),g)}},h=function(){g(f.text)};b.init=function(b,c,f){d=b;e=c;a.addEvent(b.nodeList[e],"click",h)};b.hide=function(){};b.destroy=function(){d=null};return b}});
STK.register("common.extra.shine",function(a){var b=function(a){return a.slice(0,a.length-1).concat(a.concat([]).reverse())};return function(c,d){var e=a.parseParam({start:"#fff",color:"#fbb",times:2,step:5,length:4},d),f=e.start.split(""),g=e.color.split(""),h=[];for(var i=0;i<e.step;i+=1){var j=f[0];for(var k=1;k<e.length;k+=1){var l=parseInt(f[k],16),m=parseInt(g[k],16);j+=Math.floor(parseInt(l+(m-l)*i/e.step,10)).toString(16)}h.push(j)}for(var i=0;i<e.times;i+=1)h=b(h);var n=!1,o=a.timer.add(function(){if(!h.length)a.timer.remove(o);else{if(n){n=!1;return}n=!0;c.style.backgroundColor=h.pop()}})}});
typeof scope=="undefined"&&(scope={});scope.loginKit=function(){var a=document.cookie+";",b=["SUP","=([^;]*)?;"].join(""),c=["(\\?|&)","uid","=([^&]*)(&|$)"].join(""),d=a.match(new RegExp(b,"i"));d=d?d[1]||"":"";d=unescape(d);var e=d.match(new RegExp(c));e=e?e[2]||"":"";var f=scope.$oid;return{uid:e,isLogin:!!e,isAdmin:e&&f&&e==f}};scope.$isLogin=function(){return scope.loginKit().isLogin};scope.$isAdmin=function(){return scope.loginKit().isAdmin};
STK.register("common.topic.basePublisher",function(a){function h(b,c){function k(){d.imageWidget&&typeof d.imageWidget.hide=="function"&&d.imageWidget.hide()}function j(){d.smileWidget&&typeof d.smileWidget.hide=="function"&&d.smileWidget.hide()}function i(){d.canPublish?d.onpublish():a.common.extra.shine(h.textEl)}var d=this,e;this.node=b;this.opts=c||f||{};this.canPublish=!1;var g=a.common.editor.base(b,this.opts.options);this.editor=g;var h=g.nodeList;this.doms=h;this.smileWidget=a.common.editor.widget.face();this.imageWidget=a.common.editor.widget.image();g.widget(this.smileWidget,"smileyBtn");g.widget(this.imageWidget,"imageBtn");g.widget(a.common.editor.widget.topic(),"topicBtn");a.custEvent.add(this.smileWidget,"show",function(){k()});a.custEvent.add(this.imageWidget,"show",function(){j()});a.addEvent(h.publishBtn,"click",i);a.core.evt.hotKey.add(h.textEl,"ctrl+enter",i);a.addEvent(h.textEl,"focus",function(){e=setInterval(function(){f.oncount.apply(d)},200);j();var a=g.API.getExtra();a&&d.imageWidget.show();a||k()});a.addEvent(h.textEl,"blur",function(){clearInterval(e)});a.addEvent(h.textEl,"keyup",function(){f.oncount.apply(d)});f.oncount.apply(this)}var b=a.kit.extra.language,c=b('<div class="publish_state"><cite class="WB_tipB_ok commentInput_state_icon"></cite><cite class="state_txt"><cite class="fir_txt">#L{微博发布成功！}</cite><cite class="pubsta_info W_txtb">#L{数据同步可能延迟，请耐心等待}</cite></cite></div>'),d=b('<div class="publish_state"><cite class="WB_tipB_err commentInput_state_icon"></cite><cite class="state_txt"><cite class="fir_txt">##ERROR##</cite><cite class="pubsta_info W_txtb">#L{如需帮助请}<a href="http://weibo.com/weibokefu" target="_blank">@#L{微博客服}</a> #L{或者致电} 400 690 0000</cite></cite></div>'),e=b("#L{系统繁忙}"),f={options:{limitNum:140,tipText:b(""),count:"disable",atSwitch:!0},oncount:function(){var b=a.trim(this.doms.textEl.value),c=a.bLength(b),d=!1,e=Math.floor((this.opts.options.limitNum*2-c)/2);this.doms.count.innerHTML=e;this.doms.count.className=e>=0?"weibo_count":"weibo_count S_error";c==0||c>this.opts.options.limitNum*2?d=!1:d=!0;if(this.canPublish!=d){this.canPublish=d;this.doms.publishBtn.className=this.canPublish?"publisher_submit_btn":"publisher_submit_btn submit_disabled"}}},g;h.prototype.onpublish=function(){var b=this;if(a.common.login.getLoginStatus.isLogin()==!1)a.common.topic.login.login();else{if(a.common.topic.login.fullinfo()==!1)return;if(g==!0)return;g=!0;var c={app_src:$CONFIG.app_src||"",content:this.editor.API.getWords(),pic_id:this.editor.API.getExtra(),return_type:2,refer:encodeURIComponent(document.referrer),vsrc:"base_topic",wsrc:$CONFIG.wsrc||"app_topic_base",ext:"login=>1;url=>"+encodeURIComponent(document.referrer),html_type:2};this.doms.publishBtn.className="publisher_submit_btn submit_ing";var d=a.common.trans.topic.getTrans("addmblog",{onComplete:function(c){switch(c.code){case"100000":b.doms.textEl.value="";b.doms.textEl.setAttribute("extra","");b.doms.publishBtn.className="publisher_submit_btn";a.common.channel.topic.fire("publish",[c.data]);b.showTips();b.editor.closeWidget();break;default:b.doms.publishBtn.className="publisher_submit_btn";b.showTips(c.msg)}g=null},onFail:function(){b.doms.publishBtn.className="publisher_submit_btn";b.showTips(e);g=null}});d.request(c)}};h.prototype.showTips=function(b){var e,f=this;b==null?e=c:e=d.replace(/##ERROR##/,b);this.deleteTips();a.core.dom.insertHTML(this.doms.textEl.parentNode,e,"beforeend");this.timer=setTimeout(function(){f.deleteTips();f.doms.textEl.value="#"+f.topic+"#";clearTimeout(f.timer);f.timer=null},2e3)};h.prototype.deleteTips=function(){if(this.timer){clearTimeout(this.timer);this.timer=null}var b=a.core.dom.next(this.doms.textEl);b&&a.isNode(b)&&a.removeNode(b)};h.prototype.setTopic=function(a){this.topic=a;this.doms.textEl.value="#"+a+"#";f.oncount.apply(this)};h.prototype.destroy=function(){};return h});
STK.register("comp.topic.publisher",function(a){return function(b,c){function A(){var b=a.common.login.getLoginStatus.uid(),c="http://rs.sinajs.cn/tmp.gif?id=topicbase&action=pv&uid="+b+"&url="+encodeURIComponent(document.referrer)+"&r="+(new Date).valueOf();STK.pvLogImage=new Image;STK.pvLogImage.src=c}function z(b){if(a.isNode(b)){var c=b.parentNode;a.removeClassName(j.parentNode,"topic_selected");a.removeNode(a.core.dom.next(j));a.addClassName(c,"topic_selected");a.addHTML(c,s);var d=v(c);switch(d[0]){case"right":case"left":p=d[1];w();break;case"ok":}j=b;a.common.channel.topic.fire("topic_change",[j.innerHTML]);g.setTopic(j.innerHTML.replace(new RegExp("#","gi"),""));$CONFIG.short_url&&(e.textEl.value+=" "+$CONFIG.short_url);y()}}function y(){var a=e.textEl.value.length;e.textEl.setAttribute("range",a+"&0")}function x(){var a=l.length-1,b,c=9999,d;for(var e=0;e<=a;e++){var f=Math.abs(l[e].parentNode.offsetLeft-Math.abs(p)-r);if(f<c){c=f;b=l[e];d=e}}var g=v(b.parentNode);switch(g[0]){case"right":b=l[d-1];break;case"left":b=l[d+1];break;case"ok":}z(b)}function w(){a.tween(e.topicList,{}).finish({left:p})}function v(a){var b=a.offsetWidth,c=a.offsetLeft,d=c+b-5-2,e=o+Math.abs(p);return d>e?["right",p-d-7+e]:c<Math.abs(p)?["left",-c]:["ok",p]}function u(){o=e.topicList.parentNode.offsetWidth;var b=k.parentNode;q=b.offsetLeft+b.offsetWidth-o;if(q<=0){e.prev.style.display="none";e.next.style.display="none";a.core.dom.setStyle(e.topicList.parentNode,"margin","0")}else{e.prev.style.display="block";e.next.style.display="block";e.topicList.parentNode.setAttribute("style","")}o=e.topicList.parentNode.offsetWidth;q=b.offsetLeft+b.offsetWidth-o;q=q<=0?0:-q;if(p>0){p=0;w()}if(q&&p<q){p=q;w()}}function t(a,b){switch(b){case"hide":a.style.width=m-2+"px";h.style.right="259px";h.className="aside_switch_btn switch_off";return;case"show":a.style.width=n;h.style.right="517px";h.className="aside_switch_btn";return;default:}}var d={},e,f,g,h,i,j,k,l,m,n,o,p=0,q=0,r=0,s='<u class="topic_arrow S_link_l_b"></u>',B={asideSwitchBtn:function(){t(i,h.className==="aside_switch_btn"?"hide":"show");u();p=0;w();z(j)},topic:function(a){z(a.el)},prev:function(a){var b=p+o;r=j.parentNode.offsetLeft+p;p=b>0?0:b;w();x()},next:function(a){var b=p-o;r=j.parentNode.offsetLeft+p;p=b<q?q:b;w();x()}},C=function(){D();E();F();G();H();I()},D=function(){if(b==null||b!=null&&!a.core.dom.isNode(b))throw"[comp.topic.publisher]:argsCheck()-The param node is not a DOM node.";c=a.core.obj.parseParam({html:""},c)},E=function(){e=a.kit.dom.parseDOM(a.builder(b).list);h=a.E("asideSwitchBtn");i=a.E("mainPart")},F=function(){g=new a.common.topic.basePublisher(b);g.setTopic($CONFIG.tag);$CONFIG.short_url&&(e.textEl.value+=" "+$CONFIG.short_url);y();m=a.core.dom.sizzle(".WB_weibo_topic",document.body);m=m.length>0?m[0].offsetWidth:821;i&&(n=i.style.width||m-261);l=a.core.dom.sizzle(".topic_item_a",b);if(l.length>0){k=l[l.length-1];u();j=l[0];z(j)}A()},G=function(){f=a.core.evt.delegatedEvent(b);f.add("topic","click",B.topic);a.addEvent(h,"click",B.asideSwitchBtn);a.addEvent(e.prev,"click",B.prev);a.addEvent(e.next,"click",B.next)},H=function(){},I=function(){},J=function(){f.remove("topic","click",B.topic);a.removeEvent(h,"click",B.asideSwitchBtn);a.removeEvent(e.prev,"click",B.prev);a.removeEvent(e.next,"click",B.next)};C();d.destroy=J;return d}});
STK.pageletM.register("pl.topic.publisher",function(a){var b={},c=a.E("pl_topic_publisher"),d=a.comp.topic.publisher(c,b);return d});
STK.register("kit.dom.lastChild",function(a){var b=a.core.dom.prev;return function(a){var c=a.lastChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("common.login.getLoginStatus",function(a){function d(){return b().isLogin}function c(){return b().uid}function b(){var a=document.cookie+";",b=["SUP","=([^;]*)?;"].join(""),c=["(\\?|&)","uid","=([^&]*)(&|$)"].join(""),d=a.match(new RegExp(b,"i"));d=d?d[1]||"":"";d=unescape(d);var e=d.match(new RegExp(c));e=e?e[2]||"":"";return{uid:e,isLogin:!!e}}return{uid:c,isLogin:d}});
STK.register("common.topic.feedFilter",function(a){var b,c,d,e=a.kit.extra.language,f=0,g,h,i,j={setTopic:function(a){g=a;j.changeToTab(0);j.getFeedInfo(0)},setFilter:function(b){var c=b.data.index;if(c!=2||a.common.topic.login.fullinfo()!=!1){j.changeToTab(c);j.getFeedInfo(c)}},changeToTab:function(b){h==null&&(h=a.sizzle("li",c.nav));a.removeClassName(h[f],"nav_current");var d=a.kit.dom.lastChild(h[f]),e=d.cloneNode(!0);a.removeNode(d);a.addClassName(h[b],"nav_current");h[b].appendChild(e);b!=0?c.top_feed&&(c.top_feed.style.display="none"):c.top_feed&&(c.top_feed.style.display="");f=b},setCountInfo:function(a){var b;typeof a=="number"?b=a:typeof a=="boolean"&&a==!0&&(b=c.count_info.innerHTML.replace(/\D/g,"")*1+1);c.count_info.innerHTML=a==null||b==0?"":e('<a target="_blank" href="http://s.weibo.com/weibo/'+g+'&scope=ori" class="weibo_all_link">#L{查看}'+b+"#L{条相关微博}</a>")},getFeedInfo:function(){if(d!=!0){if(f==2&&a.common.login.getLoginStatus.isLogin()==!1){j.setCountInfo();a.core.evt.custEvent.fire(i.custKeySearchFail,"needlogin",[]);return}var b={app_src:$CONFIG.app_src,tag:g,og:encodeURIComponent($CONFIG.og),filter:f,language:$CONFIG.language,is_base:$CONFIG.vsrc=="base_topic"?1:0,block_key:$CONFIG.block_key||""};d=!0;var c=a.common.trans.topic.getTrans("search_topic",{onComplete:function(b){switch(b.code){case"100000":j.setCountInfo(b.data.total_number);a.core.evt.custEvent.fire(i.custKeySearchSucc,"success",[b.data]);break;default:a.core.evt.custEvent.fire(i.custKeySearchFail,"failure",[b.data])}d=null},onFail:function(){a.core.evt.custEvent.fire(i.custKeySearchFail,"failure",[ret.data]);d=null}});c.request(b)}}};return function(d,e){c=a.kit.dom.parseDOM(a.builder(d).list);g=e;b=a.core.evt.delegatedEvent(d);b.add("filter","click",j.setFilter);i={setTopic:j.setTopic,setCountInfo:j.setCountInfo,reload:j.getFeedInfo,autoload:j.getFeedInfo};i.custKeySearchSucc=a.core.evt.custEvent.define(i,"success");i.custKeySearchFail=a.core.evt.custEvent.define(i,"failure");i.custKeySearchFail=a.core.evt.custEvent.define(i,"needlogin");return i}});
STK.register("kit.dom.parentElementBy",function(a){return function(a,b,c){if(!a||!b)throw new Error("传入的参数为空");var d=0,e;a=a.parentNode;while(a.parentNode){d++;e=c(a);if(e===!1)return!1;if(e===!0)return a;if(e===b)return null;a=a.parentNode;if(d>3e4)return!1}return null}});
STK.register("ui.tipPrototype",function(a){var b=10003;return function(c){var d,e,f,g,h,i='<div node-type="outer" class="WB_widgets W_layer" style="position: absolute; display:none;" ><div node-type="inner" class="bg"></div></div>';d=a.parseParam({direct:"up",showCallback:a.core.func.empty,hideCallback:a.core.func.empty},c);e=a.module.layer(i,d);f=e.getOuter();g=e.getInner();e.setTipWH=function(){h=this.getSize(!0);this.tipWidth=h.w;this.tipHeight=h.h;return this};e.setTipWH();e.setContent=function(a){typeof a=="string"?g.innerHTML=a:g.appendChild(a);this.setTipWH();return this};e.setLayerXY=function(c){if(!c)throw"ui.tipPrototype need pNode as first parameter to set tip position";var e=STK.core.dom.position(c),g=e.l,h=c.offsetWidth,i=c.offsetHeight,j=Math.min(Math.max(g+(h-this.tipWidth)/2,a.scrollPos().left),a.scrollPos().left+STK.winSize().width-this.tipWidth),k=e.t;d.direct==="down"&&(k+=i);var l=[";"];l.push("z-index:",b++,";");l.push("width:",this.tipWidth,"px;");l.push("height:",this.tipHeight,"px;");l.push("top:",k,"px;");l.push("left:",j,"px;");f.style.cssText+=l.join("")};e.aniShow=function(){var b=this.getOuter();b.style.height="0px";b.style.display="";var c=a.core.ani.tween(b,{end:d.showCallback,duration:250,animationType:"easeoutcubic"});if(d.direct==="down")c.play({height:this.tipHeight},{staticStyle:"overflow:hidden;position:absolute;"});else{var e=parseInt(b.style.top,10)-this.tipHeight;c.play({height:this.tipHeight,top:Math.max(e,a.scrollPos().top)},{staticStyle:"overflow:hidden;position:absolute;"})}};e.anihide=function(){var b=this.getOuter(),c=this,e=a.core.ani.tween(b,{end:function(){b.style.display="none";b.style.height=c.tipHeight+"px";d.hideCallback()},duration:300,animationType:"easeoutcubic"});if(d.direct==="down")e.play({height:0},{staticStyle:"overflow:hidden;position:absolute;"});else{var f=parseInt(b.style.top,10)+this.tipHeight;e.play({height:0,top:f},{staticStyle:"overflow:hidden;position:absolute;"})}};document.body.appendChild(f);e.destroy=function(){document.body.removeChild(f);e=null};return e}});
STK.register("ui.tipAlert",function(a){var b=a.core.util.easyTemplate;return function(c){c=a.parseParam({direct:"up",className:"WB_widgets W_layer",showCallback:a.core.func.empty,hideCallback:a.core.func.empty,template:'<#et temp data><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div node-type="msgDiv" class="content layer_mini_info"><p class="clearfix alt_text"><span class="tip_icon WB_tipS_${data.type}"></span>${data.msg}&nbsp; &nbsp; &nbsp; </p></div></td></tr></tbody></table></#et>',type:"ok",msg:""},c);var d=a.ui.tipPrototype(c),e=d.getInner(),f=d.getOuter();f.className=c.className;e.className="bg";var g=c.template,h=a.builder(b(g,{type:c.type,msg:c.msg}).toString());d.setContent(h.box);var i=d.destroy;d.destroy=function(){i();d=null};return d}});
STK.register("ui.tipConfirm",function(a){return function(b){b=b||{};var c=a.ui.tipPrototype(b),d=c.getInner(),e=c.getOuter();e.className="WB_widgets W_layer";d.className="bg";b.info=b.info||"确认要删除这条微博吗？";b.icon=b.icon||"icon_ask";var f=b.template||'<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div class="content layer_mini_info"><p class="clearfix" node-type="info"><span node-type="icon" class="'+b.icon+'"></span>'+b.info+"</p>"+'<p class="btn"><a node-type="ok" class="WB_btngA" href="javascript:void(0)"><span>确定</span></a><a class="WB_btngC" node-type="cancel" href="javascript:void(0)"><span>取消</span></a></p>'+"</div>"+"</td></tr></tbody>"+"</table>",g=a.builder(f);c.setContent(g.box);if(!g.list.ok)return c;var h=g.list.ok[0],i=g.list.cancel[0];c.setIcon=function(a){g.list.info.className=a;c.setTipWH()};c.setInfo=function(a){g.list.info[0].innerHTML='<span node-type="icon" class="'+b.icon+'"></span>'+a;c.setTipWH()};c.cancelCallback=function(){a.getType(b.cancelCallback)=="function"&&b.cancelCallback()};c.okCallback=function(){a.getType(b.okCallback)=="function"&&b.okCallback()};var j=function(){c.anihide();c.cancelCallback()},k=function(){c.anihide();c.okCallback()};a.addEvent(i,"click",j);a.addEvent(h,"click",k);var l=c.destroy;c.destroy=function(){a.removeEvent(i,"click",j);a.removeEvent(h,"click",k);l();c=null};return c}});
STK.register("common.topic.forwardNewPublisher",function(a){function h(c,d){function k(){j.textEl.value==b("#L{请输入转发理由}")&&(j.textEl.value="");e.canPublish?e.onpublish():a.common.extra.shine(j.textEl)}var e=this,g;this.node=c;this.opts={};for(var h in f)d[h]==null?this.opts[h]=f[h]:this.opts[h]=d[h];var i=a.common.editor.base(c,this.opts.options);this.editor=i;var j=i.nodeList;this.doms=j;this.smileWidget=a.common.editor.widget.face();i.widget(this.smileWidget,"smileyBtn");a.addEvent(j.forwardBtn,"click",k);a.core.evt.hotKey.add(j.textEl,"ctrl+enter",k);a.addEvent(j.textEl,"focus",function(){g=setInterval(function(){e.opts.oncount.apply(e)},200);j.textEl.value==b("#L{请输入转发理由}")&&(j.textEl.value="")});a.addEvent(j.textEl,"blur",function(){clearInterval(g);a.trim(j.textEl.value)==""&&(j.textEl.value=b("#L{请输入转发理由}"))});i.API.focus()}var b=a.kit.extra.language,c=b('<div class="textarea_note"><u class="WB_tipS_ok"></u><cite class="textarea_note_text">#L{发布成功}</cite></div>'),d=b('<div class="textarea_note"><u class="WB_tipS_err"></u><cite class="textarea_note_text">#L{##ERROR##}</cite></div>'),e=b("#L{系统繁忙}"),f={mid:"",srcuid:"",options:{limitNum:140,tipText:b(""),count:"disable",atSwitch:!0},oncount:function(){var b=a.trim(this.doms.textEl.value),c=a.bLength(b),d=!1,e=Math.floor((this.opts.options.limitNum*2-c)/2);if(this.doms.count){this.doms.count.innerHTML=e;this.doms.count.className=e>=0?"weibo_count":"weibo_count S_error"}c>this.opts.options.limitNum*2?d=!1:d=!0;this.canPublish=d}},g;h.prototype.onpublish=function(){var c=this;if(!a.common.topic.delegate.fullinfo()){if(a.common.login.getLoginStatus.isLogin()==!1){a.common.topic.delegate.login(null,function(){c.onpublish.apply(c,arguments)});return}if(g==!0)return;g=!0;var d={app_src:$CONFIG.app_src||"",content:this.editor.API.getWords(),mid:this.opts.mid,vsrc:$CONFIG.vsrc||"pk_topic",wsrc:$CONFIG.wsrc||"app_topic_base",url:encodeURIComponent(document.referrer)};!this.doms.is_comment.checked||(d.is_comment=1);this.doms.forwardBtn.innerHTML=b('<cite class="WB_gray3_btn_inner"><u class="WB_ico_loadingD"></u>#L{转发中}</cite>');this.doms.forwardBtn.className="submit_btn WB_gray3_btn";var f=a.common.trans.topic.getTrans("repost",{onComplete:function(e){switch(e.code){case"100000":c.doms.textEl.value="";c.canPublish=!1;c.doms.forwardBtn.innerHTML=b('<cite class="WB_red_btn_inner">#L{转发}</cite>');c.doms.forwardBtn.className="submit_btn WB_red_btn";c.opts.oncount.apply(c);a.common.channel.feed.fire("forward",[e.data,d]);c.showTips();break;default:c.doms.forwardBtn.innerHTML=b('<cite class="WB_red_btn_inner">#L{转发}</cite>');c.doms.forwardBtn.className="submit_btn WB_red_btn";c.showTips(e.msg)}g=null},onFail:function(){c.showTips(e);g=null}});f.request(d)}};h.prototype.showTips=function(b){var e,f=this;b==null?e=c:e=d.replace(/##ERROR##/,b);this.deleteTips();a.core.dom.insertHTML(this.doms.textEl.parentNode,e,"beforeend");this.timer=setTimeout(function(){f.deleteTips();b==null&&a.common.channel.feed.fire("forward_hide",[f.opts.mid]);clearTimeout(f.timer);f.timer=null},2e3)};h.prototype.deleteTips=function(){if(this.timer){clearTimeout(this.timer);this.timer=null}var b=a.core.dom.next(this.doms.textEl);b&&a.isNode(b)&&a.removeNode(b)};h.prototype.destroy=function(){a.core.evt.hotKey.remove(this.doms.textEl,"ctrl+enter");a.removeEvent(this.doms.forwardBtn,"click");a.removeEvent(this.doms.textEl,"focus");a.removeEvent(this.doms.textEl,"blur")};return h});
STK.register("common.topic.commentNewPublisher",function(a){function h(b,c){function j(){d.canPublish?d.onpublish():a.common.extra.shine(i.textEl)}var d=this,e;this.node=b;this.opts={};for(var g in f)c[g]==null?this.opts[g]=f[g]:this.opts[g]=c[g];var h=a.common.editor.base(b,this.opts.options);this.editor=h;var i=h.nodeList;this.doms=i;this.canPublish=a.trim(i.textEl.value)==""?!1:!0;this.smileWidget=a.common.editor.widget.face();h.widget(this.smileWidget,"smileyBtn");a.addEvent(i.commentBtn,"click",j);a.core.evt.hotKey.add(i.textEl,"ctrl+enter",j);a.addEvent(i.textEl,"focus",function(){e=setInterval(function(){d.opts.oncount.apply(d)},200)});a.addEvent(i.textEl,"blur",function(){clearInterval(e)});h.API.focus()}var b=a.kit.extra.language,c=b('<div class="textarea_note"><u class="WB_tipS_ok"></u><cite class="textarea_note_text">#L{评论成功}</cite></div>'),d=b('<div class="textarea_note"><u class="WB_tipS_err"></u><cite class="textarea_note_text">#L{##ERROR##}</cite></div>'),e=b("#L{系统繁忙}"),f={mid:"",srcuid:"",options:{limitNum:140,tipText:b(""),count:"disable",atSwitch:!0},oncount:function(){var b=a.trim(this.doms.textEl.value),c=a.bLength(b),d=!1,e=Math.floor((this.opts.options.limitNum*2-c)/2);if(this.doms.count){this.doms.count.innerHTML=e;this.doms.count.className=e>=0?"weibo_count":"weibo_count S_error"}c==0||c>this.opts.options.limitNum*2?d=!1:d=!0;this.canPublish=d}},g;h.prototype.onpublish=function(){var c=this;if(!a.common.topic.delegate.fullinfo()){if(a.common.login.getLoginStatus.isLogin()==!1){a.common.topic.delegate.login(null,function(){c.onpublish.apply(c,arguments)});return}if(g==!0)return;g=!0;var d={app_src:$CONFIG.app_src||"",content:this.editor.API.getWords(),mid:this.opts.mid,is_repost:this.doms.is_repost.checked?1:0,vsrc:$CONFIG.vsrc||"pk_topic",wsrc:$CONFIG.wsrc||"app_topic_base",url:encodeURIComponent(document.referrer)};c.commentId!=null&&(d.cid=this.commentId);this.doms.commentBtn.innerHTML=b('<cite class="WB_gray3_btn_inner"><u class="WB_ico_loadingD"></u>#L{评论中}</cite>');this.doms.commentBtn.className="submit_btn WB_gray3_btn";var f=a.common.trans.topic.getTrans("comment",{onComplete:function(e){switch(e.code){case"100000":case"A00006":c.commentId=null;c.doms.textEl.value="";c.canPublish=!1;c.doms.commentBtn.className="submit_btn WB_red_btn";c.doms.commentBtn.innerHTML=b('<cite class="WB_red_btn_inner">#L{评论}</cite>');c.opts.oncount.apply(c);a.common.channel.feed.fire("comment",[e.data,d]);c.showTips();break;default:c.doms.commentBtn.className="submit_btn WB_red_btn";c.doms.commentBtn.innerHTML=b('<cite class="WB_red_btn_inner">#L{评论}</cite>');c.showTips(e.msg)}g=null},onFail:function(){c.showTips(e);g=null}});f.request(d)}};h.prototype.setCid=function(a){this.commentId=a};h.prototype.showTips=function(b){var e,f=this;b==null?e=c:e=d.replace(/##ERROR##/,b);this.deleteTips();a.core.dom.insertHTML(this.doms.textEl.parentNode,e,"beforeend");this.timer=setTimeout(function(){f.deleteTips();b==null&&a.common.channel.feed.fire("comment_hide",[f.opts.mid]);clearTimeout(f.timer);f.timer=null},2e3)};h.prototype.deleteTips=function(){if(this.timer){clearTimeout(this.timer);this.timer=null}var b=a.core.dom.next(this.doms.textEl);b&&a.isNode(b)&&a.removeNode(b)};h.prototype.destroy=function(){this.commentId=null;a.core.evt.hotKey.remove(this.doms.textEl,"ctrl+enter");a.removeEvent(this.doms.commentBtn,"click");a.removeEvent(this.doms.textEl,"focus");a.removeEvent(this.doms.textEl,"blur")};return h});
STK.register("common.topic.feedManage",function(a){var b=a.kit.extra.language,c,d,e,f,g,h={},i={},j={},k,l=null,m,n,o=b('<div class="weibo_feed_info"><div class="loading_status_container"><u class="WB_tipB_warn"></u></div><div class="status_note">#L{还没有人发表过相关微博，赶快抢沙发吧!}</div></div>'),p=b('<div class="weibo_feed_info"><div class="loading_status_container"><u class="WB_tipB_warn"></u></div><div class="status_note">#L{数据查询失败，请}<a href="#" onclick="return false;" action-type="reload">#L{重试}</a></div></div>'),q=b('<div class="weibo_feed_info"><div class="loading_status_container"><u class="WB_tipB_warn"></u></div><div class="status_note">#L{你还没登录哦，请先}<a href="#" onclick="return false;" action-type="login">#L{登录}</a>#L{后查看}</div></div>'),r={login:q,error:p},s=b('<div class="handle_expand S_border S_bg_ex" node-type="forward"><div class="expand_arrow" style="right:80px;"><cite class="expand_arrow_border S_border_c">◆</cite><cite class="expand_arrow_content S_bg_ex_c">◆</cite></div><div class="expand_container"><div class="input_container" node-type="publisher"><div class="expand_textarea_container"><textarea class="expand_textarea" node-type="textEl"></textarea></div><div class="input_submit"><div class="input_media" node-type="widget"><a href="#" onclick="return false;" class="media_link" node-type="smileyBtn" title=""><u class="WB_ico_face"></u></a><label class="input_form_plus"><input type="checkbox" class="WB_checkbox2" node-type="is_comment">#L{同时评论}</label></div><div class="submit_btn_container"><cite class="weibo_count" node-type="count">140</cite><a href="#" onclick="return false;" node-type="forwardBtn" class="submit_btn WB_red_btn" title=""><cite class="WB_red_btn_inner">#L{转发}</cite></a></div></div></div>#######</div></div>'),t=b('<div class="handle_expand S_border S_bg_ex" node-type="comment"><div class="expand_arrow" style="right:0;"><cite class="expand_arrow_border S_border_c">◆</cite><cite class="expand_arrow_content S_bg_ex_c">◆</cite></div><div class="expand_container"><div class="input_container" node-type="publisher"><div class="expand_textarea_container"><textarea class="expand_textarea" node-type="textEl"></textarea></div><div class="input_submit"><div class="input_media" node-type="widget"><a href="#" onclick="return false;" class="media_link" node-type="smileyBtn" title=""><u class="WB_ico_face"></u></a><label class="input_form_plus"><input type="checkbox" class="WB_checkbox2" node-type="is_repost" checked="checked" />#L{同时转发}</label></div><div class="submit_btn_container"><cite class="weibo_count" node-type="count">140</cite><a href="#" onclick="return false;" node-type="commentBtn" class="submit_btn WB_red_btn" title=""><cite class="WB_red_btn_inner">#L{评论}</cite></a></div></div></div>#######</div></div>'),u=b('<ul class="layer_handle_list"><li class="layer_handle_item"><a class="layer_handle_link" href="javascript:;" action-type="blockMid">#L{屏蔽这条微博}</a></li><li class="layer_handle_item"><a class="layer_handle_link" href="javascript:;" action-type="blockUid">#L{禁言这个用户}</a></li></ul>'),v=b('<ul class="layer_handle_list"><li class="layer_handle_item"><a class="layer_handle_link" href="javascript:;" action-type="allowMid">#L{解除屏蔽}</a></li></ul>'),w=b('<ul class="layer_handle_list"><li class="layer_handle_item"><a class="layer_handle_link" href="javascript:;" action-type="allowUid">#L{解除禁言}</a></li></ul>'),x=b("#L{确认要取消收藏这条微博吗？}"),y=b("#L{回复}"),z={setFeedListHTML:function(a){e.error_node&&(e.error_node.style.display="none");a.top_feed&&(e.top_feed.style.display="");e.scroll_list.innerHTML=a.html;e.feedlist.style.display="";e.scroll_list.scrollTop=0},closeTopTopic:function(b){var c=a.kit.dom.parentElementBy(b.el,document.body,function(a){if(a.getAttribute("node-type")=="top_feed")return!0});c!=null&&(c.style.display="none")},setFakeHTML:function(b){var c=a.sizzle("ul",e.scroll_list);if(c.length>0){c=c[0];a.insertHTML(c,b,"afterbegin")}else e.scroll_list.innerHTML="<ul>"+b+"</ul>"},setFailHTML:function(b){var c=r[b];c==null&&(c=r.error);if(e.error_node==null){a.addHTML(d,'<div node-type="error_node">'+c+"</div>");var f=a.sizzle('div[node-type="error_node"]',d);f.length>0&&(e.error_node=f[0])}else e.error_node.innerHTML=c;e.error_node.style.display="";e.feedlist.style.display="none"},reloadTopic:function(){a.core.evt.custEvent.fire(f.custKeyReload,"reload",[])},preview:function(a){if(a.el){var b=a.el,c=b.src;if(b.className=="WB_big_cursor"){b.src=c.replace("thumbnail","bmiddle");b.className="WB_small_cursor"}else{b.src=c.replace("bmiddle","thumbnail");b.className="WB_big_cursor"}}},onscroll:function(){var b=e.scroll_list;b.scrollTop+b.clientHeight==b.scrollHeight&&a.core.evt.custEvent.fire(f.custKeyReload,"autoload",[])},forward:function(a){var c=a.data.mid,d=a.el;if(h[c]!=null&&h[c].allowForward!=null)if(h[c].allowForward==1)if(d.getAttribute("open")!=1){z.getFeedInfo(a,z.initForwardPublisher,"forward");d.setAttribute("open",1);z.hideComment(a)}else{d.setAttribute("open",null);z.hideForward(a)}else z.showBubble(b("#L{由于作者隐私设置，你没有权限转发此微博。}"),a.el,!0);else z.getMidInfo(c,function(){z.forward(a)})},comment:function(a){var c=a.data.mid,d=a.el;if(h[c]!=null&&h[c].allowComment!=null)if(h[c].allowComment==1)if(d.getAttribute("open")!=1){z.getFeedInfo(a,z.initCommentPublisher,"comment");d.setAttribute("open",1);z.hideForward(a)}else{d.setAttribute("open",null);z.hideComment(a)}else z.showBubble(b("#L{由于作者隐私设置，你没有权限评论此微博。}"),a.el,!0);else z.getMidInfo(c,function(){z.comment(a)})},hideComment:function(b){var c=b.data.mid,d=b.el,e;while(d.getAttribute("action-type")!="comment")d=a.core.dom.next(d);d.setAttribute("open",null);var f=z.getContainer(d),g=a.sizzle('[node-type="comment"]',f);g.length>0&&(g[0].style.display="none");z.hideSmileLayer()},hideForward:function(b){var c=b.data.mid,d=b.el,e;while(d.getAttribute("action-type")!="forward")d=a.core.dom.prev(d);d.setAttribute("open",null);var f=z.getContainer(d),g=a.sizzle('[node-type="forward"]',f);g.length>0&&(g[0].style.display="none");z.hideSmileLayer()},reply:function(b,c){var d=b.data.mid,e=b.el,f=a.sizzle('a[class="user_name"]',e.parentNode.parentNode),g,h;if(f.length>0){g=f[0].title;switch(c){case"forward":h=i[d].editor.API;break;case"comment":j[d].setCid(b.data.cid);h=j[d].editor.API}h.reset();h.insertText(y+g+":")}},getFeedInfo:function(b,c,d){if(g!=!0){if(a.common.login.getLoginStatus.isLogin()==!1){a.common.topic.login.login();return}if(a.common.topic.login.fullinfo()==!1)return;var e=b.data.mid,f={wsrc:$CONFIG.wsrc||"app_topic_base",app_src:$CONFIG.default_app_src,mid:e,count:2,language:$CONFIG.language,output:2};g=!0;var h=a.common.trans.topic.getTrans(d=="forward"?"get_forward":"get_comment",{onComplete:function(a){switch(a.code){case"100000":c&&c(a.data,b);break;default:c&&c(null,b)}g=null},onFail:function(){c&&c(null,b);g=null}});h.request(f)}},initForwardPublisher:function(c,d){var e=d.data.mid,f=d.el,g,h=z.getContainer(f),j=a.sizzle('[node-type="forward"]',h);g=s.replace("#######",c);g=g.replace("right:80px;","right:"+Math.max(f.parentNode.offsetWidth-24,0)+"px");if(j.length==0){a.addHTML(h,g);j=a.sizzle('[node-type="forward"]',h)[0];var l=a.kit.dom.parseDOM(a.builder(j).list);i[e]=new a.common.topic.forwardNewPublisher(l.publisher,{mid:e||"",srcuid:d.data.srcuid||""});k=i[e].smileWidget}else{j=j[0];j.style.display="";var m=a.sizzle('[node-type="textEl"]',j)[0];m.value="";var n=a.sizzle('[node-type="forwardBtn"]',j)[0];n.className="submit_btn WB_red_btn";n.innerHTML=b('<cite class="WB_red_btn_inner">#L{转发}</cite>');var o=a.sizzle('[node-type="count"]',j)[0];o.className="weibo_count";o.innerHTML="140";var p=a.sizzle('[node-type="is_comment"]',j)[0];p.checked=!1;i[e].canPublish=!1}},initCommentPublisher:function(c,d){var e=d.data.mid,f=d.el,g,h=z.getContainer(f),i=a.sizzle('[node-type="comment"]',h);g=t.replace("#######",c);g=g.replace("right:0;","right:"+Math.max(f.offsetWidth-24,0)+"px");if(i.length==0){a.addHTML(h,g);i=a.sizzle('[node-type="comment"]',h)[0];var l=a.kit.dom.parseDOM(a.builder(i).list);j[e]=new a.common.topic.commentNewPublisher(l.publisher,{mid:d.data.mid||"",srcuid:d.data.srcuid||"",name:d.data.cid||"",cid:d.data.name||""});k=j[e].smileWidget}else{i=i[0];i.style.display="";var m=a.sizzle('[node-type="textEl"]',i)[0];m.value="";var n=a.sizzle('[node-type="commentBtn"]',i)[0];n.className="submit_btn WB_red_btn";n.innerHTML=b('<cite class="WB_red_btn_inner">#L{评论}</cite>');var o=a.sizzle('[node-type="count"]',i)[0];o.className="weibo_count";o.innerHTML="140";var p=a.sizzle('[node-type="is_repost"]',i)[0];p.checked=!0;j[e].canPublish=!1}},getContainer:function(b){var c=a.kit.dom.parentElementBy(b,document.body,function(a){if(a.className=="feed_item S_separate_l"||a.className=="top_weibo_item"||a.className=="feed_item S_separate_l feed_item_forbidden")return!0});return c},getMidInfo:function(b,c){if(g!=!0){if(a.common.login.getLoginStatus.isLogin()==!1){a.common.topic.login.login();return}if(a.common.topic.login.fullinfo()==!1)return;var d={wsrc:$CONFIG.wsrc||"app_topic_base",appkey:$CONFIG.appkey,action:"",mid:b};g=!0;var e=a.common.trans.topic.getTrans("check",{onComplete:function(a){g=null;switch(a.code){case"100000":h[b]=a.data;c&&c();break;default:h[b]={allowForward:0,allowComment:0};c&&c()}},onFail:function(){g=null;h[b]={allowForward:0,allowComment:0};c&&c()}});e.request(d)}},favorite:function(c,d){var e=this;if(a.common.login.getLoginStatus.isLogin()==!1)a.common.topic.login.login();else{if(a.common.topic.login.fullinfo()==!1)return;if(g==!0)return;g=!0;var f={wsrc:$CONFIG.wsrc||"app_topic_base",app_src:$CONFIG.default_app_src||"",mid:c.data.mid},h=a.common.trans.topic.getTrans("addfav",{onComplete:function(a){var e;switch(a.code){case"100000":if(d!=null&&typeof d=="function")d(a.data);else{c.el.innerHTML=b("#L{取消收藏}");c.el.setAttribute("action-type","unfavorite");z.showBubble(b("#L{收藏成功}"),c.el)}break;default:z.showBubble(a.msg,c.el,!0)}g=null},onFail:function(){z.showBubble(SYSTEM_BUSY,c.el,!0);g=null}});h.request(f)}},unfavorite:function(c,d){if(g!=!0){g=!0;var e=this,f=a.ui.tipConfirm({info:x,icon:"tip_icon WB_tipS_ques",okCallback:function(){var e={wsrc:$CONFIG.wsrc||"app_topic_base",app_src:$CONFIG.default_app_src||"",mid:c.data.mid},f=a.common.trans.topic.getTrans("delfav",{onComplete:function(a){var e;switch(a.code){case"100000":if(d!=null&&typeof d=="function")d(a.data);else{c.el.innerHTML=b("#L{收藏}");c.el.setAttribute("action-type","favorite");z.showBubble(b("#L{取消收藏成功}"),c.el)}break;default:z.showBubble(a.msg,c.el,!0)}g=null},onFail:function(){z.showBubble(SYSTEM_BUSY,c.el,!0);g=null}});f.request(e)},hideCallback:function(){g=null},template:b('<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div class="content layer_mini_info"><div class="clearfix" node-type="info"><cite class="tip_icon WB_tipS_ques"></cite>'+x+"</div>"+'<div class="btn"><a node-type="ok" class="WB_orange_btn" href="#" onclick="return false;"><cite class="WB_orange_btn_inner">#L{确定}</cite></a>'+'<a class="WB_gray5_btn" node-type="cancel" href="#" onclick="return false;"><cite class="WB_gray5_btn_inner">#L{取消}</cite></a></div>'+"</div>"+"</td></tr></tbody>"+"</table>")});f.setLayerXY(c.el);f.aniShow()}},showBubble:function(b,c,d){var e=this,f=a.ui.tipAlert({showCallback:function(){setTimeout(function(){f&&f.anihide()},600)},hideCallback:function(){tipOnMid=undefined;f&&f.destroy();f=null},msg:b,type:d?"err":"ok",template:'<#et temp data><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info"><div class="clearfix"><span class="tip_icon WB_tipS_${data.type}"></span>${data.msg}</div></div></td></tr></tbody></table></#et>'});f.setLayerXY(c);f.aniShow()},hideSmileLayer:function(){k&&typeof k.hide=="function"&&k.hide();a.E("admin_menu")&&(a.E("admin_menu").style.display="none")},adminShow:function(b){b=a.fixEvent(b);var c=b.target;while(c.className!="feed_item S_separate_l feed_item_forbidden"&&c.className!="feed_item S_separate_l"&&c!=e.scroll_list)c=c.parentNode;if(c.className=="feed_item S_separate_l feed_item_forbidden"||c.className=="feed_item S_separate_l"){var d=0;while(c.childNodes[d].className!="admin_feed_handle")d++;c.childNodes[d].style.display="block";if(l&&l!=c.childNodes[d]){l.style.display="none";a.E("admin_menu").style.display="none"}l=c.childNodes[d]}else l&&(l.style.display="block")},adminHide:function(b){b=a.fixEvent(b);var c=b.target;c.className!="layer_handle_link"&&c.className!="admin_feed_handle_link"&&(a.E("admin_menu").style.display="none")},block:function(b){var c=a.core.dom.position(b.el),d=a.E("admin_menu"),e;console.log(b.data.is_block);switch(b.data.is_block){case"1":d.innerHTML=v;e=c.l-63;break;case"2":d.innerHTML=w;e=c.l-63;break;default:d.innerHTML=u;e=c.l-83}d.style.display=="none"?d.style.display="block":d.style.display="none";a.core.dom.setXY(d,{t:c.t+11,l:e});m=b.data.mid;n=b.data.uid},blockAjax:function(b){var c=a.common.trans.topic.getTrans("block",{onComplete:function(b){switch(b.code){case"100000":default:z.reloadTopic();a.E("admin_menu").style.display="none"}},onFail:function(){z.reloadTopic();a.E("admin_menu").style.display="none"}});c.request(b)},blockMid:function(a){var b={app_src:$CONFIG.app_src,block_key:$CONFIG.block_key,block_id:m,blockid_type:1,is_del:0};z.blockAjax(b)},blockUid:function(a){var b={app_src:$CONFIG.app_src,block_key:$CONFIG.block_key,block_id:n,blockid_type:2,is_del:0};z.blockAjax(b)},allowMid:function(a){var b={app_src:$CONFIG.app_src,block_key:$CONFIG.block_key,block_id:m,blockid_type:1,is_del:1};z.blockAjax(b)},allowUid:function(a){var b={app_src:$CONFIG.app_src,block_key:$CONFIG.block_key,block_id:n,blockid_type:2,is_del:1};z.blockAjax(b)}};return function(b){d=b;e=a.kit.dom.parseDOM(a.builder(b).list);c=a.core.evt.delegatedEvent(b);c.add("close","click",z.closeTopTopic);c.add("reload","click",z.reloadTopic);c.add("forward","click",function(a){z.forward(a)});c.add("forward_reply","click",function(a){z.reply(a,"forward")});c.add("favorite","click",function(a){z.favorite(a)});c.add("unfavorite","click",function(a){z.unfavorite(a)});c.add("comment","click",function(a){z.comment(a)});c.add("comment_reply","click",function(a){z.reply(a,"comment")});c.add("preview","click",z.preview);c.add("login","click",function(){a.common.topic.login.login()});a.addEvent(e.scroll_list,"scroll",function(){z.hideSmileLayer()});if($CONFIG.is_admin=="1"){a.addEvent(e.scroll_list,"mouseover",z.adminShow);a.addEvent(document.body,"click",z.adminHide);c.add("block","click",z.block);c.add("blockMid","click",z.blockMid);c.add("blockUid","click",z.blockUid);c.add("allowMid","click",z.allowMid);c.add("allowUid","click",z.allowUid)}f={setFeedListHTML:z.setFeedListHTML,setFakeHTML:z.setFakeHTML,setFailHTML:z.setFailHTML};f.custKeyReload=a.core.evt.custEvent.define(f,"reload");f.custKeyReload=a.core.evt.custEvent.define(f,"count");f.custKeyReload=a.core.evt.custEvent.define(f,"autoload");return f}});
STK.register("common.channel.topic",function(a){var b=["publish","forward","forward_hide","comment","comment_hide","reload","vote","topic_change"];return a.common.listener.define("common.channel.topic",b)});
STK.register("comp.topic.viewpoint",function(a){var b=a.kit.extra.language;return function(b,c){var d={},e,f,g=$CONFIG.tag,h={},i={},j={reloadTopic:function(a){e.setTopic(a)},writeToList:function(a){f.setFakeHTML(a)}},k=function(){l();m();n();o();p();q()},l=function(){if(b==null||b!=null&&!a.core.dom.isNode(b))throw"[comp.topic.viewpoint]:argsCheck()-The param node is not a DOM node.";c=a.core.obj.parseParam({html:""},c)},m=function(){},n=function(){e=a.common.topic.feedFilter(b,g);f=a.common.topic.feedManage(b)},o=function(){},p=function(){a.custEvent.add(e,"success",function(a,b){f.setFeedListHTML(b)});a.custEvent.add(e,"failure",function(){f.setFailHTML("error")});a.custEvent.add(e,"needlogin",function(){f.setFailHTML("login")});a.custEvent.add(f,"count",function(){});a.custEvent.add(f,"reload",function(){e.reload()});a.custEvent.add(f,"autoload",function(){e.autoload()})},q=function(){a.common.channel.topic.register("topic_change",function(a){a!=null&&(a=a.replace(/#/g,""));j.reloadTopic(a)});a.common.channel.topic.register("publish",j.writeToList)},r=function(){};k();d.destroy=r;return d}});
STK.pageletM.register("pl.topic.viewpoint",function(a){var b={},c=a.E("pl_topic_viewpoint"),d=a.comp.topic.viewpoint(c,b);return d});
STK.register("core.obj.parseParam",function(a){return function(a,b,c){var d,e={};b=b||{};for(d in a){e[d]=a[d];b[d]!=null&&(c?a.hasOwnProperty[d]&&(e[d]=b[d]):e[d]=b[d])}return e}});
STK.register("common.widget.log",function(a){var b={app_sharebutton:1,app_followbutton:2,app_livestream:4,app_listweibo:5,app_weiboshow:6,app_commentbox:7};return function(c){var d=a.core.obj.parseParam({vsrc:"app_weiboshow",refer:"",step:1},c),e=scope.refer||scope.$refer||d.refer,f=scope.loginKit().uid||"",g=scope.appkey||$CONFIG.$appkey||$CONFIG.appkey||0,h=b[d.vsrc]||"",i="http://rs.sinajs.cn/r.gif?uid="+f+"&appid="+g+"&refer="+e+"&cat="+h+"&step="+d.step+"&rnd="+ +(new Date),j=new Image;j.src=i;j=null}});
STK.register("common.widget.login",function(a){var b={vsrc:"app_weiboshow",appsrc:"",showlogo:0,callback:function(){}};typeof App=="undefined"&&(App={});return function(c){c=a.parseParam(b,c);c.appsrc||(c.appsrc=scope?scope.appsrc?scope.appsrc:scope.$appsrc?scope.$appsrc:"":"");var d={};App.loginBackUrlCallBack=function(b){a.custEvent.fire(d,"login",b);c.step=2;a.common.widget.log(c)};var e=function(){f();g();h();i()},f=function(){},g=function(){},h=function(){a.custEvent.define(d,"login")},i=function(){a.custEvent.add(d,"login",function(a){c.callback(a)})};d.showLogin=function(){var b="&"+a.jsonToQuery(c),d="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl=http%3A%2F%2F"+location.host+"%2Fstaticjs%2FloginProxy.html"+b+"&rnd="+ +(new Date).valueOf();/weibo.com/.test(location.host)&&(d=d.replace(/\/widget/,""));var e=window.open(d,"miniblog_login",["toolbar=1,status=0,resizable=1,width=620,height=540,left=",(screen.width-620)/2,",top=",(screen.height-450)/2].join(""));e.focus();a.common.widget.log(c)};e();return d}});
STK.register("common.widget.reg",function(a){var b=a.kit.extra.language,c=a.ui.tipAlert({className:"WB_tips_top",showCallback:function(){var a=c.getOuter();a.style.height="";a=null},template:'<#et temp data><div class="tips_inner"><span class="WB_tipS_warn"></span><span class="WB_icon_txt">'+b("#L{您的帐号尚未开通微博，}")+'<a href="http://weibo.com/signup/full_info.php?appsrc=6cm7D0&backurl='+encodeURIComponent(document.URL)+'&showlogo=0&vsrc=weiboshow&from=zw" target="_blank">'+b("#L{立即开通}")+"</a></span>"+"</#et>"});return function(b){if(!a.isNode(b))throw"[common.widget.reg] need node as first parameter";c.setLayerXY(b);c.aniShow();return c}});
STK.register("common.widget.addFollowBtn",function(a){var b=a.kit.extra.language,c=function(){},d={uid:scope.loginKit().uid,url:"",fuid:"",vsrc:"",success:c,fail:c,followed:"",self:"",followfail:"",followedClass:"",ext:"",app_src:""},e=function(c,d){if(d.fuid===d.uid){if(d.self){c.innerHTML=d.self?b(d.self):b("#L{你自己}");c.className=d.followedClass?d.followedClass:c.className}return"yourself"}d.url||(d.url="/public/aj_attention.php");a.ajax({method:"post",url:d.url,args:{ext:d.ext?d.ext:"",fid:d.fuid,refer:encodeURIComponent(document.location.href),vsrc:d.vsrc,url:document.referrer?encodeURIComponent(document.referrer):encodeURIComponent(document.location.href),app_src:d.app_src},onComplete:function(f){switch(f.code){case"A00006":break;case"A10007":break;case"A10008":break;case-1:a.common.widget.reg(c);break;case-2:var g=a.common.widget.login();a.custEvent.add(g,"login",function(){d.uid=scope.loginKit().uid;e(d)});g.showLogin();break;case-3:}if(f.code!="A00006"&&f.code!="A10007"&&f.code!="A10008"||!c){c.innerHTML=d.followfail?b(d.followfail):b("#L{请重试}");typeof d.fail=="function"&&d.fail()}else{c.innerHTML=d.followed?b(d.followed):b("#L{已关注}");c.className=d.followedClass?d.followedClass:c.className;typeof d.success=="function"&&d.success(f)}},onFail:function(){c.innerHTML=d.followfail?b(d.followfail):b("#L{请重试}");typeof d.fail=="function"&&d.fail()}})};return function(b,c){if(!b)throw"[common.widget.addFollowBtn] need node as parameter";var f=function(){if(parent==self||parent==parent.parent){if(a.common.login.getLoginStatus.isLogin()==!1){a.common.topic.login.login();return}if(a.common.topic.login.fullinfo()==!1)return;if(!scope.$isLogin()){var b=a.common.widget.login();a.custEvent.add(b,"login",function(){c.uid=scope.loginKit().uid;e(this,c)});b.showLogin();return}e(this,c)}},g={},h=function(){c=a.parseParam(d,c);c.fuid||(c.fuid=b.getAttribute("uid"));i()},i=function(){a.addEvent(b,"click",f)},j=function(b){a.removeEvent(b,"click",f)};g.destroy=j;h();return g}});
STK.register("comp.topic.sidebar",function(a){var b=a.core.ani.tween,c=a.kit.extra.language,d=c("#L{已关注}"),e=c("#L{你自己}"),f=c("#L{请重试}");return function(g,h){function x(){r&&(l.style.display="none")}function w(){l.style.display=l&&"block";r=!1}function v(){var b='<div class="WB_widget usercard_layer" style="display:none;top:9999px;left:9999px;" id="usercard"><div class="usercard_layer_outside"><div class="usercard_layer_inside" id="cardMain"></div><div class="layer_arrow_inside_b"></div></div><div class="layer_arrow_outside_b"></div></div>';a.insertHTML(document.body,b,"beforeend");l=a.E("usercard");l&&a.addEvent(l,"mouseover",y.keepCarte);l&&a.addEvent(l,"mouseout",y.timeoutCarte)}function u(b){var d=a.E("cardMain"),e=a.common.trans.topic.getTrans("getcard",{onComplete:function(b){switch(b.code){case"100000":d.innerHTML=b.data;var c=a.core.dom.sizzle(".follow_status_btn",d);if(c.length>0){c=c[0];c.style.display="none"}w();break;default:}},onFail:function(){d.innerHTML=c("#L{获取名片失败}")}});d&&e.request(b)}function t(a,c,d){switch(d){case"show":b(a,{end:function(){c.className="relay_withdraw_btn";a.className="related_item S_separate_r";a.setAttribute("style","");n=a;o=c}}).finish({height:a.scrollHeight-15});return;case"hide":b(a,{end:function(){c.className="relay_expand_btn";a.className="related_item related_item_fold S_separate_r";a.setAttribute("style","")}}).finish({height:45});return;default:}}var i={},j,k,l,m,n,o,p,q,r=!1,s=!1,y={showCarte:function(b){if(a.common.login.getLoginStatus.isLogin()!=!1){if(a.common.topic.login.fullinfo(!1)==!1)return;var c=a.fixEvent(b);if((c.target.className==="user_avatar"||c.target.className==="personal_name")&&l){var d=a.core.dom.position(c.target),e=a.core.dom.getSize(c.target),f=a.core.dom.getSize(l);l.style.left=d.l-f.width+e.width+"px";l.style.top=d.t+e.height+8+"px";if(!s){var g={wsrc:$CONFIG.wsrc||"app_topic_base",fuid:$CONFIG.fuid,language:$CONFIG.language};u(g);s=!0}else w()}}},hideCarte:function(b){var c=a.fixEvent(b);(c.target.className==="user_avatar"||c.target.className==="personal_name")&&y.timeoutCarte()},relaySwitchBtn:function(a){a.el!==n&&t(n,o,"hide");t(a.el.parentNode,a.el,a.el.className==="relay_withdraw_btn"?"hide":"show")},keepCarte:function(){r=!1},timeoutCarte:function(){r=!0;setTimeout(x,1e3)}},z={},A={weekrank:function(b){var c={tag:b,app_src:$CONFIG.app_src,language:$CONFIG.language,is_base:$CONFIG.vsrc=="base_topic"?1:0,block_key:$CONFIG.block_key||""},d=a.common.trans.topic.getTrans("getweekrank",{onComplete:function(b){switch(b.code){case"100000":j.weekrank&&(j.weekrank.innerHTML=b.data.html);o=a.core.dom.sizzle('[action-type="relaySwitchBtn"]',g);if(o.length>0){o=o[0];n=o.parentNode}break;default:}},onFail:function(){}});d.request(c)}},B=function(){C();D();E();F();G();H()},C=function(){if(g==null||g!=null&&!a.core.dom.isNode(g))throw"[comp.topic.sidebar]:argsCheck()-The param node is not a DOM node.";h=a.core.obj.parseParam({html:""},h)},D=function(){j=a.builder(g).list;j=a.kit.dom.parseDOM(j)},E=function(){o=a.core.dom.sizzle('[action-type="relaySwitchBtn"]',g);if(o.length>0){o=o[0];n=o.parentNode}j.followBtn&&(p=new a.common.widget.addFollowBtn(j.followBtn,{fuid:$CONFIG.fuid,wsrc:$CONFIG.wsrc||"app_topic_base",vsrc:$CONFIG.vsrc,followed:'<cite class="WB_follow_status_inner"><cite class="WB_follow_box"><u class="WB_icon_followed"></u>'+d+"</cite></cite>",self:'<cite class="WB_follow_status_inner"><cite class="WB_follow_box"><u class="WB_icon_followed"></u>'+e+"</cite></cite>",followfail:'<cite class="WB_orange_btn_inner">'+f+"</cite>",followedClass:"WB_gray_btn",success:function(){p.destroy(j.followBtn)}}));v()},F=function(){k=a.core.evt.delegatedEvent(g);k.add("relaySwitchBtn","click",y.relaySwitchBtn);a.addEvent(j.sidebar_carte,"mouseover",y.showCarte);a.addEvent(j.sidebar_carte,"mouseout",y.hideCarte)},G=function(){},H=function(){a.common.channel.topic.register("topic_change",function(a){a!=null&&(a=a.replace(/#/g,""));A.weekrank(a)})},I=function(){k.remove("relaySwitchBtn","click",y.relaySwitchBtn);a.removeEvent(j.sidebar_carte,"mouseover",y.showCarte);a.removeEvent(j.sidebar_carte,"mouseout",y.hideCarte)};B();i.destroy=I;return i}});
STK.pageletM.register("pl.topic.sidebar",function(a){var b={},c=a.E("pl_topic_sidebar"),d=a.comp.topic.sidebar(c,b);return d});
STK.pageletM.start();
